/*!
 * EasyWechat.js v1.0.0
 * (c) 2017-2017 Hpyer
 * Released under the MIT License.
 */
"use strict";function t(t){return t&&"object"==typeof t&&"default"in t?t.t:t}function e(t){return new Promise(function(e,n){function i(o,c){try{var u=t[c?"e":"n"](o)}catch(t){return void n(t)}u.i?e(u.r):Promise.resolve(u.r).then(i,r)}function r(t){i(t,1)}i()})}var n=t(require("merge")),i=t(require("request")),r=t(require("qs")),o=t(require("sha1"));const c={o:"",c:""};class u{constructor(t={}){if(this.u=n({},c,t),!this.u.o)throw new Error("\u672a\u586b\u5199appKey");if(!this.u.c)throw new Error("\u672a\u586b\u5199appSecret");this.s.forEach(t=>{this[t].l(this)})}}u.prototype.a=(t=>new Promise((e,n)=>{i({f:"GET",p:t},function(t,i,r){if(t)n(t);else try{r=JSON.parse(r),e(r)}catch(t){n(t)}})})),u.prototype.d=((t,e=null)=>new Promise((n,r)=>{i({f:"POST",p:t,h:e},function(t,e,i){if(t)r(t);else try{n(i)}catch(t){r(t)}})})),u.prototype.s=[],u.y=((t,e)=>{u.prototype[t]=e,u.prototype.s.push(t)});const s="https://open.weixin.qq.com/connect/oauth2/authorize",l="https://open.weixin.qq.com/connect/qrconnect",a="https://api.weixin.qq.com/sns/oauth2/access_token",f="https://api.weixin.qq.com/sns/userinfo";class p{constructor(){this.w="",this.m="",this.name="",this._="",this.q={},this.T={}}}var d;const h=function(t){d=t},y=function(t=""){if(!d.u.g)return"";if(!d.u.g.v)throw new Error("\u672a\u586b\u5199\u6388\u6743scope");if(!d.u.g.S)throw new Error("\u672a\u586b\u5199\u6388\u6743\u56de\u8c03\u5730\u5740");let e=d.u.g.S;if("http://"!=e.substr(0,7)&&"https://"!=e.substr(0,8))throw new Error("\u8bf7\u586b\u5199\u5b8c\u6574\u7684\u56de\u8c03\u5730\u5740\uff0c\u4ee5\u201chttp://\u201d\u6216\u201chttps://\u201d\u5f00\u5934");let n=s;"snsapi_login"==d.u.g.v&&(n=l);let i={k:d.u.o,b:e,A:"code",v:d.u.g.v};return t&&(i.C=t),n+"?"+r.stringify(i)+"#wechat_redirect"};var w=null;const m=function(t){return e(function*(){return yield _(t),yield E(),w}())},_=function(t){return e(function*(){let e={k:d.u.o,x:d.u.c,D:t,j:"authorization_code"},n=a+"?"+r.stringify(e),i=yield d.a(n);w||(w=new p),w.w=i.N,w.T=i}())},E=function(){return e(function*(){let t={I:w.T.I,N:w.w,K:"zh_CN"},e=f+"?"+r.stringify(t),n=yield d.a(e);w.w=n.N,w.m=n.m,w.name=n.m,w._=n.O,w.q=n}())};var q={l:function(t){d=t},S:function(t=""){if(!d.u.g)return"";if(!d.u.g.v)throw new Error("\u672a\u586b\u5199\u6388\u6743scope");if(!d.u.g.S)throw new Error("\u672a\u586b\u5199\u6388\u6743\u56de\u8c03\u5730\u5740");let e=d.u.g.S;if("http://"!=e.substr(0,7)&&"https://"!=e.substr(0,8))throw new Error("\u8bf7\u586b\u5199\u5b8c\u6574\u7684\u56de\u8c03\u5730\u5740\uff0c\u4ee5\u201chttp://\u201d\u6216\u201chttps://\u201d\u5f00\u5934");let n=s;"snsapi_login"==d.u.g.v&&(n=l);let i={k:d.u.o,b:e,A:"code",v:d.u.g.v};return t&&(i.C=t),n+"?"+r.stringify(i)+"#wechat_redirect"},P:function(t){return e(function*(){return yield _(t),yield E(),w}())}};const T=function(){return parseInt((new Date).getTime()/1e3)},g=function(t=16){let e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n="";for(let i=0;i<t;i++)n+=e.charAt(Math.floor(Math.random()*e.length));return n},v=function(t,n){return e(function*(){let e=yield t.I.J();return n+"?access_token="+e}())};var S={H:function(){return parseInt((new Date).getTime()/1e3)},L:function(t=16){let e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n="";for(let i=0;i<t;i++)n+=e.charAt(Math.floor(Math.random()*e.length));return n},M:function(t,n){return e(function*(){let e=yield t.I.J();return n+"?access_token="+e}())}};class k{constructor(){this.U={}}W(t){return this.Y(t)?this.U[t].z:null}Y(t,e=0){let n=this.U[t];return"object"==typeof n&&!(n.R>0&&n.R-e<S.H())}G(t,e=null,n=0){let i={z:e,R:n>0?n+S.H():0};this.U[t]=i}delete(t){this.U[t]=null}}var b;const A=function(t){(b=t).u.B=b.u.B||new k},C=function(t){t&&"function"==typeof t.W&&"function"==typeof t.Y&&"function"==typeof t.G&&"function"==typeof t.delete&&($cache=t)};var x={l:function(t){(b=t).u.B=b.u.B||new k},F:k,Q:function(t){t&&"function"==typeof t.W&&"function"==typeof t.Y&&"function"==typeof t.G&&"function"==typeof t.delete&&($cache=t)}};const D="https://api.weixin.qq.com/cgi-bin/token";var j;const N=function(t){(j=t).u.I=j.u.I||{},j.u.I.X=j.u.I.X||"NODE_EASYWECHAT_ACCESS_TOKEN",j.u.I.Z=j.u.I.Z||60},I=function(){return e(function*(){let t={k:j.u.o,x:j.u.c,j:"client_credential"},e=D+"?"+r.stringify(t);return yield j.a(e)}())},K=function(t=!1){return e(function*(){let e=j.u.B.W(j.u.I.X);if(t||!j.u.B.Y(j.u.I.X,j.u.I.Z)){let t=yield I();O(t.I,t.$),e=t.I}return e}())},O=function(t,e=7200){j.u.B.G(j.u.I.X,t,e)};var P={l:function(t){(j=t).u.I=j.u.I||{},j.u.I.X=j.u.I.X||"NODE_EASYWECHAT_ACCESS_TOKEN",j.u.I.Z=j.u.I.Z||60},J:function(t=!1){return e(function*(){let e=j.u.B.W(j.u.I.X);if(t||!j.u.B.Y(j.u.I.X,j.u.I.Z)){let t=yield I();O(t.I,t.$),e=t.I}return e}())},V:O};const J="https://api.weixin.qq.com/cgi-bin/ticket/getticket";var H;const L=function(t){(H=t).u.tt=H.u.tt||{},H.u.tt.X=H.u.tt.X||"NODE_EASYWECHAT_JSSKD_TICKET",H.u.tt.Z=H.u.tt.Z||60};var M="";const U=function(t){M=t},W=function(){return e(function*(){let t={I:yield H.I.J(),et:"jsapi"},e=J+"?"+r.stringify(t);return yield H.a(e)}())},Y=function(t,n=!1,i=!0){return e(function*(){let e=H.u.B.W(H.u.tt.X);if(!H.u.B.Y(H.u.tt.X,H.u.tt.Z)){let t=yield W();H.u.B.G(H.u.tt.X,t.nt,t.$),e=t.nt}let r=M,o=S.L(),c=S.H(),u=z({it:e,rt:o,ot:c,ct:r}),s={ut:n,st:H.u.o,ot:c,lt:o,at:u,ct:r,ft:t};return M="",i?JSON.stringify(s):s}())},z=function(t){let e="",n="";for(let i in t)e+=n+i+"="+t[i],n="&";return o(e)};var R={l:function(t){(H=t).u.tt=H.u.tt||{},H.u.tt.X=H.u.tt.X||"NODE_EASYWECHAT_JSSKD_TICKET",H.u.tt.Z=H.u.tt.Z||60},pt:function(t){M=t},dt:function(t,n=!1,i=!0){return e(function*(){let e=H.u.B.W(H.u.tt.X);if(!H.u.B.Y(H.u.tt.X,H.u.tt.Z)){let t=yield W();H.u.B.G(H.u.tt.X,t.nt,t.$),e=t.nt}let r=M,o=S.L(),c=S.H(),u=z({it:e,rt:o,ot:c,ct:r}),s={ut:n,st:H.u.o,ot:c,lt:o,at:u,ct:r,ft:t};return M="",i?JSON.stringify(s):s}())}};const G="https://api.weixin.qq.com/cgi-bin/message/template/send",B="https://api.weixin.qq.com/cgi-bin/template/get_industry",F="https://api.weixin.qq.com/cgi-bin/template/api_set_industry",Q="https://api.weixin.qq.com/cgi-bin/template/api_add_template",X="https://api.weixin.qq.com/cgi-bin/template/get_all_private_template",Z="https://api.weixin.qq.com/cgi-bin/template/del_private_template";var $;const V=function(t){$=t,et=new tt};class tt{constructor(){this.ht()}}tt.prototype.ht=function(){this.yt="",this.wt="",this.ct="",this.mt={},this.z=[]};let et=null;const nt=function(t){return et.yt=t,this},it=function(t){return et.wt=t,this},rt=function(t){return et.ct=t,this},ot=function(t){return et.z=ct(t),this},ct=function(t){let e={};for(let n in t){let i=t[n];"object"==typeof i?void 0!==i.length?e[n]={r:i[0],_t:i[1]}:e[n]=i:e[n]={r:i}}return e},ut=function(t=null){return e(function*(){if(t?t.z&&(t.z=ct(t.z)):t={},t=n({},et,t),et.ht(),!t.yt)throw new Error("\u7528\u6237openid\u4e3a\u7a7a");if(!t.wt)throw new Error("\u6a21\u677fid\u4e3a\u7a7a");let e=yield S.M($,G);return yield $.d(e,t)}())},st=function(){return e(function*(){let t=yield S.M($,B);return yield $.d(t)}())},lt=function(t,n){return e(function*(){let e=yield S.M($,F),i={Et:t,qt:n};return yield $.d(e,i)}())},at=function(t){return e(function*(){let e=yield S.M($,Q),n={Tt:t};return yield $.d(e,n)}())},ft=function(){return e(function*(){let t=yield S.M($,X);return yield $.d(t)}())},pt=function(t){return e(function*(){let e=yield S.M($,Z),n={wt:t};return yield $.d(e,n)}())};var dt={l:function(t){$=t,et=new tt},gt:nt,vt:nt,St:nt,kt:nt,bt:nt,At:nt,Ct:it,xt:it,Dt:it,jt:it,Nt:it,It:it,Kt:it,Ot:it,Pt:it,ct:rt,Jt:rt,Ht:rt,link:rt,Lt:rt,Mt:rt,Ut:rt,Wt:rt,Yt:rt,z:ot,zt:ot,Rt:ot,Gt:function(t=null){return e(function*(){if(t?t.z&&(t.z=ct(t.z)):t={},t=n({},et,t),et.ht(),!t.yt)throw new Error("\u7528\u6237openid\u4e3a\u7a7a");if(!t.wt)throw new Error("\u6a21\u677fid\u4e3a\u7a7a");let e=yield S.M($,G);return yield $.d(e,t)}())},Bt:function(){return e(function*(){let t=yield S.M($,B);return yield $.d(t)}())},Ft:function(t,n){return e(function*(){let e=yield S.M($,F),i={Et:t,qt:n};return yield $.d(e,i)}())},Qt:function(t){return e(function*(){let e=yield S.M($,Q),n={Tt:t};return yield $.d(e,n)}())},Xt:function(){return e(function*(){let t=yield S.M($,X);return yield $.d(t)}())},Zt:function(t){return e(function*(){let e=yield S.M($,Z),n={wt:t};return yield $.d(e,n)}())}};u.y("oauth",q),u.y("cache",x),u.y("access_token",P),u.y("jssdk",R),u.y("notice",dt),module.$t=u;