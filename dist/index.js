/*!
 * EasyWechat.js v1.3.2
 * (c) 2017-2017 Hpyer
 * Released under the MIT License.
 */
"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}function t(e){return new Promise(function(t,n){function i(r,o){try{var c=e[o?"throw":"next"](r)}catch(e){return void n(e)}c.done?t(c.value):Promise.resolve(c.value).then(i,s)}function s(e){i(e,1)}i()})}var n=e(require("merge")),i=e(require("request")),s=e(require("body")),r=e(require("url")),o=e(require("qs")),c=e(require("fs")),a=e(require("path")),u=e(require("sha1")),l=require("xml2js");class d{constructor(e,t){this.$req=e,this.$res=t}getMethod(){return this.$req?this.$req.method:{}}getQuery(){return this.$req?r.parse(this.$req.url,!0).query:{}}_readBody(){return new Promise((e,t)=>{s(this.$req,(n,i)=>{n?t(n):e(i)})}).catch(e=>{console.log("app_server._readBody()",e)})}getBody(){return t(function*(){return this.$req?yield this._readBody():""}.call(this))}_initResponseOptions(e={}){return e.status=e.status||200,e.contentType=e.contentType||"text/html",e.headers=e.headers||{},e.headers["Content-Type"]=e.contentType,e}sendResponse(e,t={}){if(!this.$res)return!1;t=this._initResponseOptions(t),this.$res.writeHead(t.status,t.headers),this.$res.end(e)}}class f extends d{constructor(e){super(e.req,e.res),this.$ctx=e}sendResponse(e,t={}){if(!this.$ctx)return!1;t=this._initResponseOptions(t),this.$ctx.status=t.status;for(let e in t.headers)this.$ctx.set(e,t.headers[e]);this.$ctx.body=e}}class p extends d{constructor(e,t){super(e,t)}sendResponse(e,t={}){if(!this.$res)return!1;t=this._initResponseOptions(t),this.$res.status(t.status).set(t.headers).send(e)}}const h={appKey:"",appSecret:""};class g{constructor(e={}){if(this.$config=n({},h,e),!this.$config.appKey)throw new Error("\u672a\u586b\u5199appKey");if(!this.$config.appSecret)throw new Error("\u672a\u586b\u5199appSecret");this.$plugins.forEach(e=>{this[e].init(this)})}setAppServerDefault(e,t){this.$config.app=new d(e,t)}setAppServerKoa2(e){this.$config.app=new f(e)}setAppServerExpress(e,t){this.$config.app=new p(e,t)}}g.prototype.requestGet=(e=>new Promise((t,n)=>{i({method:"GET",uri:e},function(e,i,s){if(e)n(e);else{try{s=JSON.parse(s)}catch(e){}t(s)}})})),g.prototype.requestFile=(e=>new Promise((t,n)=>{i({method:"GET",uri:e,encoding:"binary"},function(e,i,s){e?n(e):t(s)})})),g.prototype.requestPost=((e,t=null)=>new Promise((n,s)=>{i({method:"POST",uri:e,json:t},function(e,t,i){e?s(e):n(i)})})),g.prototype.$plugins=[],g.registPlugin=((e,t)=>{g.prototype[e]=t,g.prototype.$plugins.push(e)});const m="https://open.weixin.qq.com/connect/oauth2/authorize",_="https://open.weixin.qq.com/connect/qrconnect",y="https://api.weixin.qq.com/sns/oauth2/access_token",k="https://api.weixin.qq.com/sns/userinfo";class q{constructor(){this.id="",this.nickname="",this.name="",this.avatar="",this.original={},this.token={}}}var $;const T=function(e){$=e},w=function(e=""){if(!$.$config.oauth)return"";if(!$.$config.oauth.scope)throw new Error("\u672a\u586b\u5199\u6388\u6743scope");if(!$.$config.oauth.redirect)throw new Error("\u672a\u586b\u5199\u6388\u6743\u56de\u8c03\u5730\u5740");let t=$.$config.oauth.redirect;if("http://"!=t.substr(0,7)&&"https://"!=t.substr(0,8))throw new Error("\u8bf7\u586b\u5199\u5b8c\u6574\u7684\u56de\u8c03\u5730\u5740\uff0c\u4ee5\u201chttp://\u201d\u6216\u201chttps://\u201d\u5f00\u5934");let n=m;"snsapi_login"==$.$config.oauth.scope&&(n=_);let i={appid:$.$config.appKey,redirect_uri:t,response_type:"code",scope:$.$config.oauth.scope};return e&&(i.state=e),n+"?"+o.stringify(i)+"#wechat_redirect"},b=function(e){return t(function*(){let t=yield P(e);return"snsapi_base"!=$.$config.oauth.scope&&(t=yield v(t)),t}())},P=function(e){return t(function*(){let t={appid:$.$config.appKey,secret:$.$config.appSecret,code:e,grant_type:"authorization_code"},n=y+"?"+o.stringify(t),i=yield $.requestGet(n),s=new q;return s.id=i.openid,s.token=i,s}())},v=function(e){return t(function*(){let t={access_token:e.token.access_token,openid:e.id,lang:"zh_CN"},n=k+"?"+o.stringify(t),i=yield $.requestGet(n);return i.errcode?(console.log("oauth.fetchUserInfo()",i),!1):(e.id=i.openid,e.nickname=i.nickname,e.name=i.nickname,e.avatar=i.headimgurl,e.original=i,e)}())};var x={init:function(e){$=e},redirect:function(e=""){if(!$.$config.oauth)return"";if(!$.$config.oauth.scope)throw new Error("\u672a\u586b\u5199\u6388\u6743scope");if(!$.$config.oauth.redirect)throw new Error("\u672a\u586b\u5199\u6388\u6743\u56de\u8c03\u5730\u5740");let t=$.$config.oauth.redirect;if("http://"!=t.substr(0,7)&&"https://"!=t.substr(0,8))throw new Error("\u8bf7\u586b\u5199\u5b8c\u6574\u7684\u56de\u8c03\u5730\u5740\uff0c\u4ee5\u201chttp://\u201d\u6216\u201chttps://\u201d\u5f00\u5934");let n=m;"snsapi_login"==$.$config.oauth.scope&&(n=_);let i={appid:$.$config.appKey,redirect_uri:t,response_type:"code",scope:$.$config.oauth.scope};return e&&(i.state=e),n+"?"+o.stringify(i)+"#wechat_redirect"},user:function(e){return t(function*(){let t=yield P(e);return"snsapi_base"!=$.$config.oauth.scope&&(t=yield v(t)),t}())}};const S=function(){return parseInt((new Date).getTime()/1e3)},E=function(e=16){let t="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n="";for(let i=0;i<e;i++)n+=t.charAt(Math.floor(Math.random()*t.length));return n},M=function(e,n){return t(function*(){let t=yield e.access_token.getToken();return n+"?access_token="+t}())},C=function(e){if(!e)return e;if("object"!=typeof e)return e;let t=new Object;for(let n in e)t[n]=C(e[n]);return t},U=function(){let e=arguments;if(0==e.length)return null;let t=C(e[0]);if(1==e.length)return t;for(let n=1;n<e.length;n++)if(e[n]&&"object"==typeof e[n])for(let i in e[n])t[i]=e[n][i];return t};var A={getTimestamp:function(){return parseInt((new Date).getTime()/1e3)},randomString:function(e=16){let t="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n="";for(let i=0;i<e;i++)n+=t.charAt(Math.floor(Math.random()*t.length));return n},buildApiUrl:function(e,n){return t(function*(){let t=yield e.access_token.getToken();return n+"?access_token="+t}())},cloneObj:C,extendObj:function(){let e=arguments;if(0==e.length)return null;let t=C(e[0]);if(1==e.length)return t;for(let n=1;n<e.length;n++)if(e[n]&&"object"==typeof e[n])for(let i in e[n])t[i]=e[n][i];return t}};class j{fetch(e){return null}contains(e,t=0){return!0}save(e,t=null,n=0){return!0}delete(e){return!0}}class I extends j{constructor(){this.$datas={}}fetch(e){return this.contains(e)?this.$datas[e].data:null}contains(e){return"object"==typeof this.$datas[e]}save(e,t=null,n=0){let i={data:t,lifeTime:n>0?n+A.getTimestamp():0};return this.$datas[e]=i,!0}delete(e){return delete this.$datas[e],!0}}class N extends j{constructor(e){let t={path:"",dirMode:511,fileMode:438,ext:".cache"};this.$options=A.extendObj(t,e),this.$options.path=a.resolve(this.$options.path);try{c.mkdirSync(this.$options.path,this.$options.dirMode)}catch(e){console.log("\u65e0\u6cd5\u521b\u5efa\u7f13\u5b58\u76ee\u5f55\uff1a"+this.$options.path,e)}}getCacheFile(e){return this.$options.dir+e+this.$options.ext}fetch(e){let t=null,n=this.getCacheFile(e);try{let e=c.openSync(n),i=JSON.parse(c.readFileSync(e,{encoding:"utf-8",flag:"r"}));c.closeSync(e),t=i.lifeTime>0&&i.lifeTime<A.getTimestamp()?null:i.data}catch(e){console.log("\u65e0\u6cd5\u8bfb\u53d6\u7f13\u5b58\u6587\u4ef6\uff1a"+n,e),t=null}return t}contains(e,t=0){let n=this.getCacheFile(e);try{c.accessSync(n,c.constants.R_OK&c.constants.W_OK)}catch(e){return!1}return!0}save(e,t=null,n=0){let i=this.getCacheFile(e);try{n>0&&A.getTimestamp();c.writeFileSync(i,JSON.stringify(dataTime),{mode:this.$options.fileMode,encoding:"utf-8",flag:"w"})}catch(e){return console.log("\u65e0\u6cd5\u5199\u5165\u7f13\u5b58\u6587\u4ef6\uff1a"+i,e),!1}return!0}delete(e){let t=this.getCacheFile(e);try{c.unlinkSync(t)}catch(e){return console.log("\u65e0\u6cd5\u5220\u9664\u7f13\u5b58\u6587\u4ef6\uff1a"+t,e),!1}return!0}}var R=Object.freeze({CacheInterface:j,MemoryCache:I,FileCache:N}),D;const O=function(e){if(!(D=e).$config.cache)switch(D.$config.cache_driver){case"file":D.$config.cache=new N(D.$config.cache_options);break;case"memory":default:D.$config.cache=new I}},K=function(e){e&&"function"==typeof e.fetch&&"function"==typeof e.contains&&"function"==typeof e.save&&"function"==typeof e.delete&&(D.$config.cache=e)};var F={init:function(e){if(!(D=e).$config.cache)switch(D.$config.cache_driver){case"file":D.$config.cache=new N(D.$config.cache_options);break;case"memory":default:D.$config.cache=new I}},setCache:function(e){e&&"function"==typeof e.fetch&&"function"==typeof e.contains&&"function"==typeof e.save&&"function"==typeof e.delete&&(D.$config.cache=e)}};const G="https://api.weixin.qq.com/cgi-bin/token";var Q;const H=function(e){(Q=e).$config.access_token_cache_key=Q.$config.access_token_cache_key||"NODE_EASYWECHAT_ACCESS_TOKEN"},J=function(){return t(function*(){let e={appid:Q.$config.appKey,secret:Q.$config.appSecret,grant_type:"client_credential"},t=G+"?"+o.stringify(e);return yield Q.requestGet(t)}())},L=function(e=!1){return t(function*(){let t=null;if(e||!Q.$config.cache.contains(Q.$config.access_token_cache_key)){let e=yield J();z(e.access_token,e.expires_in),t=e.access_token}else t=Q.$config.cache.fetch(Q.$config.access_token_cache_key);return t}())},z=function(e,t=7200){Q.$config.cache.save(Q.$config.access_token_cache_key,e,t)};var B={init:function(e){(Q=e).$config.access_token_cache_key=Q.$config.access_token_cache_key||"NODE_EASYWECHAT_ACCESS_TOKEN"},getToken:function(e=!1){return t(function*(){let t=null;if(e||!Q.$config.cache.contains(Q.$config.access_token_cache_key)){let e=yield J();z(e.access_token,e.expires_in),t=e.access_token}else t=Q.$config.cache.fetch(Q.$config.access_token_cache_key);return t}())},setToken:z};const V="https://api.weixin.qq.com/cgi-bin/ticket/getticket";var W;const Y=function(e){(W=e).$config.jssdk_cache_key=W.$config.jssdk_cache_key||"NODE_EASYWECHAT_JSSKD_TICKET"};var X="";const Z=function(e){X=e},ee=function(){return t(function*(){let e={access_token:yield W.access_token.getToken(),type:"jsapi"},t=V+"?"+o.stringify(e);return yield W.requestGet(t)}())},te=function(e,n=!1,i=!0){return t(function*(){let t=null;if(W.$config.cache.contains(W.$config.jssdk_cache_key))t=W.$config.cache.fetch(W.$config.jssdk_cache_key);else{let e=yield ee();W.$config.cache.save(W.$config.jssdk_cache_key,e.ticket,e.expires_in),t=e.ticket}let s=X,r=A.randomString(),o=A.getTimestamp(),c=ne({jsapi_ticket:t,noncestr:r,timestamp:o,url:s}),a={debug:n,appId:W.$config.appKey,timestamp:o,nonceStr:r,signature:c,url:s,jsApiList:e};return X="",i?JSON.stringify(a):a}())},ne=function(e){let t="",n="";for(let i in e)t+=n+i+"="+e[i],n="&";return u(t)};var ie={init:function(e){(W=e).$config.jssdk_cache_key=W.$config.jssdk_cache_key||"NODE_EASYWECHAT_JSSKD_TICKET"},setUrl:function(e){X=e},config:function(e,n=!1,i=!0){return t(function*(){let t=null;if(W.$config.cache.contains(W.$config.jssdk_cache_key))t=W.$config.cache.fetch(W.$config.jssdk_cache_key);else{let e=yield ee();W.$config.cache.save(W.$config.jssdk_cache_key,e.ticket,e.expires_in),t=e.ticket}let s=X,r=A.randomString(),o=A.getTimestamp(),c=ne({jsapi_ticket:t,noncestr:r,timestamp:o,url:s}),a={debug:n,appId:W.$config.appKey,timestamp:o,nonceStr:r,signature:c,url:s,jsApiList:e};return X="",i?JSON.stringify(a):a}())}};class se{constructor(e){this.dataParams={ToUserName:"",FromUserName:"",CreateTime:A.getTimestamp(),MsgType:""},this.json=null,this.data="","object"==typeof e?this.json=e:this.data=e}setAttribute(e,t){this.dataParams[e]=t}formatData(){return"<xml>"+this._formatData(this.dataParams)+"</xml>"}_formatData(e){if("object"==typeof e){let t="";for(let n in e)t+=`<${n}>${this._formatData(e[n])}</${n}>`;return t}return"string"==typeof e?"<![CDATA["+e+"]]>":e}getData(){return this.json?JSON.stringify(this.json):(this.data||(this.data=this.formatData()),this.data)}}class re extends se{constructor(e){super(""),this.dataParams.MsgType="text",this.dataParams.Content=e.content||""}content(e){this.dataParams.Content=e}}class oe extends se{constructor(e){super(""),this.dataParams.MsgType="image",this.dataParams.Image={MediaId:e.media_id||""}}mediaId(e){this.dataParams.Image.MediaId=e}}class ce extends se{constructor(e){super(""),this.dataParams.MsgType="voice",this.dataParams.Voice={MediaId:e.media_id||""}}mediaId(e){this.dataParams.Voice.MediaId=e}}class ae extends se{constructor(e){super(""),this.dataParams.MsgType="video",this.dataParams.Video={MediaId:e.media_id||"",Title:e.title||"",Description:e.description||""}}mediaId(e){this.dataParams.Video.MediaId=e}title(e){this.dataParams.Video.Title=e}description(e){this.dataParams.Video.Description=e}}class ue extends se{constructor(e){super(""),this.dataParams.MsgType="music",this.dataParams.Music={MediaId:e.media_id||"",Title:e.title||"",Description:e.description||"",MusicUrl:e.music_url||"",HQMusicUrl:e.hq_music_url||"",ThumbMediaId:e.thumb_media_id||""}}mediaId(e){this.dataParams.Music.MediaId=e}title(e){this.dataParams.Music.Title=e}description(e){this.dataParams.Music.Description=e}musicUrl(e){this.dataParams.Music.MusicUrl=e}hqMusicurl(e){this.dataParams.Music.HQMusicUrl=e}thumbMediaId(e){this.dataParams.Music.ThumbMediaId=e}}class le extends se{constructor(e){super(""),this.dataParams.MsgType="news",this.dataParams.ArticleCount=1,this.dataParams.Articles={item:{Title:e.title||"",Description:e.description||"",Url:e.url||"",PicUrl:e.image||""}}}title(e){this.dataParams.Articles.item.Title=e}description(e){this.dataParams.Articles.item.Description=e}url(e){this.dataParams.Articles.item.Url=e}picUrl(e){this.dataParams.Articles.item.PicUrl=e}}var de=Object.freeze({Raw:se,Text:re,Image:oe,Voice:ce,Video:ae,Music:ue,News:le}),fe;const pe=function(e){fe=e,he=function(){}};let he,ge;const me=function(e){"function"!=typeof e&&(e=function(){}),he=e},_e=function(){return t(function*(){let e=fe.$config.app;if(!e)throw new Error("\u672a\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u8bbe\u7f6e\u5e94\u7528\u670d\u52a1\u5668");if("GET"==e.getMethod()){let t=e.getQuery();if(!(t.signature&&t.echostr&&t.timestamp&&t.nonce))return void e.sendResponse("Hello node-easywechat");let n=[t.nonce,t.timestamp,fe.$config.token].sort();u(n.join(""))===t.signature?e.sendResponse(t.echostr):e.sendResponse("fail")}else{let t=yield e.getBody();if(ge=yield ye(t),he&&"function"==typeof he){let t=yield he(ge);if(!t||"string"==typeof t&&"SUCCESS"==t.toUpperCase())return void e.sendResponse("SUCCESS");let n=null;if((n="string"==typeof t?new re({content:t}):t)&&"object"==typeof n){n.setAttribute("ToUserName",ge.FromUserName),n.setAttribute("FromUserName",ge.ToUserName);let t=n.getData();console.log("server.send()",t),e.sendResponse(t)}}}}())},ye=function(e){return t(function*(){return new Promise((t,n)=>{l.parseString(e,(e,i)=>{if(e)n(e);else{let e;if(i&&i.xml){e={};for(let t in i.xml)e[t]=i.xml[t][0]}t(e)}})}).catch(e=>{console.log("server.parseMessage()",e)})}())},ke=function(){return ge};var qe={init:function(e){fe=e,he=function(){}},setMessageHandler:function(e){"function"!=typeof e&&(e=function(){}),he=e},serve:function(){return t(function*(){let e=fe.$config.app;if(!e)throw new Error("\u672a\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u8bbe\u7f6e\u5e94\u7528\u670d\u52a1\u5668");if("GET"==e.getMethod()){let t=e.getQuery();if(!(t.signature&&t.echostr&&t.timestamp&&t.nonce))return void e.sendResponse("Hello node-easywechat");let n=[t.nonce,t.timestamp,fe.$config.token].sort();u(n.join(""))===t.signature?e.sendResponse(t.echostr):e.sendResponse("fail")}else{let t=yield e.getBody();if(ge=yield ye(t),he&&"function"==typeof he){let t=yield he(ge);if(!t||"string"==typeof t&&"SUCCESS"==t.toUpperCase())return void e.sendResponse("SUCCESS");let n=null;if((n="string"==typeof t?new re({content:t}):t)&&"object"==typeof n){n.setAttribute("ToUserName",ge.FromUserName),n.setAttribute("FromUserName",ge.ToUserName);let t=n.getData();console.log("server.send()",t),e.sendResponse(t)}}}}())},getMessage:function(){return ge}};const $e="https://api.weixin.qq.com/cgi-bin/message/template/send",Te="https://api.weixin.qq.com/cgi-bin/template/get_industry",we="https://api.weixin.qq.com/cgi-bin/template/api_set_industry",be="https://api.weixin.qq.com/cgi-bin/template/api_add_template",Pe="https://api.weixin.qq.com/cgi-bin/template/get_all_private_template",ve="https://api.weixin.qq.com/cgi-bin/template/del_private_template";var xe;const Se=function(e){xe=e,Me=new Ee};class Ee{constructor(){this.reset()}}Ee.prototype.reset=function(){this.touser="",this.template_id="",this.url="",this.miniprogram={},this.data=[]};let Me=null;const Ce=function(e){return Me.touser=e,this},Ue=function(e){return Me.template_id=e,this},Ae=function(e){return Me.url=e,this},je=function(e){return Me.data=Ie(e),this},Ie=function(e){let t={};for(let n in e){let i=e[n];"object"==typeof i?void 0!==i.length?t[n]={value:i[0],color:i[1]}:t[n]=i:t[n]={value:i}}return t},Ne=function(e=null){return t(function*(){if(e?e.data&&(e.data=Ie(e.data)):e={},e=n({},Me,e),Me.reset(),!e.touser)throw new Error("\u7528\u6237openid\u4e3a\u7a7a");if(!e.template_id)throw new Error("\u6a21\u677fid\u4e3a\u7a7a");let t=yield A.buildApiUrl(xe,$e);return yield xe.requestPost(t,e)}())},Re=function(){return t(function*(){let e=yield A.buildApiUrl(xe,Te);return yield xe.requestPost(e)}())},De=function(e,n){return t(function*(){let t=yield A.buildApiUrl(xe,we),i={industry_id1:e,industry_id2:n};return yield xe.requestPost(t,i)}())},Oe=function(e){return t(function*(){let t=yield A.buildApiUrl(xe,be),n={template_id_short:e};return yield xe.requestPost(t,n)}())},Ke=function(){return t(function*(){let e=yield A.buildApiUrl(xe,Pe);return yield xe.requestPost(e)}())},Fe=function(e){return t(function*(){let t=yield A.buildApiUrl(xe,ve),n={template_id:e};return yield xe.requestPost(t,n)}())};var Ge={init:function(e){xe=e,Me=new Ee},to:Ce,withTo:Ce,andTo:Ce,receiver:Ce,withReceiver:Ce,andhReceiver:Ce,uses:Ue,withUses:Ue,andUses:Ue,template:Ue,withTemplate:Ue,andTemplate:Ue,templateId:Ue,withTemplateId:Ue,andTemplateId:Ue,url:Ae,withUrl:Ae,andUrl:Ae,link:Ae,withLink:Ae,andLink:Ae,linkTo:Ae,withLinkTo:Ae,andLinkTo:Ae,data:je,withData:je,andData:je,send:function(e=null){return t(function*(){if(e?e.data&&(e.data=Ie(e.data)):e={},e=n({},Me,e),Me.reset(),!e.touser)throw new Error("\u7528\u6237openid\u4e3a\u7a7a");if(!e.template_id)throw new Error("\u6a21\u677fid\u4e3a\u7a7a");let t=yield A.buildApiUrl(xe,$e);return yield xe.requestPost(t,e)}())},getIndustry:function(){return t(function*(){let e=yield A.buildApiUrl(xe,Te);return yield xe.requestPost(e)}())},setIndustry:function(e,n){return t(function*(){let t=yield A.buildApiUrl(xe,we),i={industry_id1:e,industry_id2:n};return yield xe.requestPost(t,i)}())},addTemplate:function(e){return t(function*(){let t=yield A.buildApiUrl(xe,be),n={template_id_short:e};return yield xe.requestPost(t,n)}())},getPrivateTemplates:function(){return t(function*(){let e=yield A.buildApiUrl(xe,Pe);return yield xe.requestPost(e)}())},deletePrivateTemplate:function(e){return t(function*(){let t=yield A.buildApiUrl(xe,ve),n={template_id:e};return yield xe.requestPost(t,n)}())}};const Qe="https://api.weixin.qq.com/cgi-bin/qrcode/create",He="https://mp.weixin.qq.com/cgi-bin/showqrcode";var Je;const Le=function(e){Je=e},ze=function(e,n=null){return t(function*(){((n=parseInt(n))<=0||n>604800)&&(n=604800);let t="";"string"==typeof e?(e={scene_str:e},t="QR_STR_SCENE"):(e={scene_id:e},t="QR_SCENE");let i={expire_seconds:n,action_name:t,action_info:{scene:e}},s=yield Je.access_token.getToken(),r=Qe+"?access_token="+s;return yield Je.requestPost(r,i)}())},Be=function(e){return t(function*(){let t="";"string"==typeof e?(e={scene_str:e},t="QR_LIMIT_STR_SCENE"):(e={scene_id:e},t="QR_LIMIT_SCENE");let n={action_name:t,action_info:{scene:e}},i=yield Je.access_token.getToken(),s=Qe+"?access_token="+i;return yield Je.requestPost(s,n)}())},Ve=function(e){return t(function*(){let t=He+"?ticket="+e;return yield Je.requestFile(t)}())};var We={init:function(e){Je=e},temporary:function(e,n=null){return t(function*(){((n=parseInt(n))<=0||n>604800)&&(n=604800);let t="";"string"==typeof e?(e={scene_str:e},t="QR_STR_SCENE"):(e={scene_id:e},t="QR_SCENE");let i={expire_seconds:n,action_name:t,action_info:{scene:e}},s=yield Je.access_token.getToken(),r=Qe+"?access_token="+s;return yield Je.requestPost(r,i)}())},forever:function(e){return t(function*(){let t="";"string"==typeof e?(e={scene_str:e},t="QR_LIMIT_STR_SCENE"):(e={scene_id:e},t="QR_LIMIT_SCENE");let n={action_name:t,action_info:{scene:e}},i=yield Je.access_token.getToken(),s=Qe+"?access_token="+i;return yield Je.requestPost(s,n)}())},url:function(e){return t(function*(){let t=He+"?ticket="+e;return yield Je.requestFile(t)}())}};const Ye="https://api.weixin.qq.com/cgi-bin/user/info",Xe="https://api.weixin.qq.com/cgi-bin/user/info/batchget",Ze="https://api.weixin.qq.com/cgi-bin/user/get",et="https://api.weixin.qq.com/cgi-bin/user/info/updateremark",tt="https://api.weixin.qq.com/cgi-bin/tags/members/getblacklist",nt="https://api.weixin.qq.com/cgi-bin/tags/members/batchblacklist",it="https://api.weixin.qq.com/cgi-bin/tags/members/batchunblacklist";class st{constructor(){this.id="",this.nickname="",this.name="",this.avatar="",this.original={},this.token={}}}var rt;const ot=function(e){rt=e},ct=function(e,n="zh_CN"){return t(function*(){let t=yield rt.access_token.getToken(),i=Ye+"?access_token="+t+"&openid="+e+"&lang="+n,s=yield rt.requestGet(i),r=new st;return r.id=s.openid,r.nickname=s.nickname,r.name=s.nickname,r.avatar=s.headimgurl,r.original=s,r}())},at=function(e){return t(function*(){let t={user_list:e},n=yield rt.access_token.getToken(),i=Xe+"?access_token="+n;return yield rt.requestPost(i,t)}())},ut=function(e=null){return t(function*(){let t=yield rt.access_token.getToken(),n=Ze+"?access_token="+t;return e&&(n+="&next_openid="+e),yield rt.requestGet(n)}())},lt=function(e,n){return t(function*(){let e=yield rt.access_token.getToken(),t=et+"?access_token="+e;return yield rt.requestPost(t)}())},dt=function(e){return t(function*(){let t={};e&&(t.begin_openid=e);let n=yield rt.access_token.getToken(),i=tt+"?access_token="+n;return yield rt.requestPost(i,t)}())},ft=function(e){return t(function*(){let t={openid_list:e},n=yield rt.access_token.getToken(),i=nt+"?access_token="+n;return yield rt.requestPost(i,t)}())},pt=function(e){return t(function*(){let t={openid_list:e},n=yield rt.access_token.getToken(),i=it+"?access_token="+n;return yield rt.requestPost(i,t)}())},ht=function(e){return t(function*(){return yield ft([e])}())},gt=function(e){return t(function*(){return yield pt([e])}())};var mt={init:function(e){rt=e},get:function(e,n="zh_CN"){return t(function*(){let t=yield rt.access_token.getToken(),i=Ye+"?access_token="+t+"&openid="+e+"&lang="+n,s=yield rt.requestGet(i),r=new st;return r.id=s.openid,r.nickname=s.nickname,r.name=s.nickname,r.avatar=s.headimgurl,r.original=s,r}())},batchGet:function(e){return t(function*(){let t={user_list:e},n=yield rt.access_token.getToken(),i=Xe+"?access_token="+n;return yield rt.requestPost(i,t)}())},lists:function(e=null){return t(function*(){let t=yield rt.access_token.getToken(),n=Ze+"?access_token="+t;return e&&(n+="&next_openid="+e),yield rt.requestGet(n)}())},remark:function(e,n){return t(function*(){let e=yield rt.access_token.getToken(),t=et+"?access_token="+e;return yield rt.requestPost(t)}())},blacklist:function(e){return t(function*(){let t={};e&&(t.begin_openid=e);let n=yield rt.access_token.getToken(),i=tt+"?access_token="+n;return yield rt.requestPost(i,t)}())},batchBlock:ft,batchUnblock:pt,block:function(e){return t(function*(){return yield ft([e])}())},unblock:function(e){return t(function*(){return yield pt([e])}())}};const _t="https://api.weixin.qq.com/cgi-bin/menu/get",yt="https://api.weixin.qq.com/cgi-bin/get_current_selfmenu_info",kt="https://api.weixin.qq.com/cgi-bin/menu/create",qt="https://api.weixin.qq.com/cgi-bin/menu/delete";var $t;const Tt=function(e){$t=e},wt=function(){return t(function*(){let e=yield $t.access_token.getToken(),t=_t+"?access_token="+e;return yield $t.requestPost(t)}())},bt=function(){return t(function*(){let e=yield $t.access_token.getToken(),t=yt+"?access_token="+e;return yield $t.requestPost(t)}())},Pt=function(e){return t(function*(){let t={button:e},n=yield $t.access_token.getToken(),i=kt+"?access_token="+n;return yield $t.requestPost(i,t)}())},vt=function(){return t(function*(){let e=qt+"?access_token="+accessToken;return yield $t.requestPost(e)}())};var xt={init:function(e){$t=e},all:function(){return t(function*(){let e=yield $t.access_token.getToken(),t=_t+"?access_token="+e;return yield $t.requestPost(t)}())},current:function(){return t(function*(){let e=yield $t.access_token.getToken(),t=yt+"?access_token="+e;return yield $t.requestPost(t)}())},add:function(e){return t(function*(){let t={button:e},n=yield $t.access_token.getToken(),i=kt+"?access_token="+n;return yield $t.requestPost(i,t)}())},destroy:function(){return t(function*(){let e=qt+"?access_token="+accessToken;return yield $t.requestPost(e)}())}};const St="https://api.weixin.qq.com/cgi-bin/shorturl";var Et;const Mt=function(e){Et=e},Ct=function(e){return t(function*(){let t={action:"long2short",long_url:e},n=yield Et.access_token.getToken(),i=St+"?access_token="+n;return yield Et.requestPost(i,t)}())};var Ut={init:function(e){Et=e},shorten:function(e){return t(function*(){let t={action:"long2short",long_url:e},n=yield Et.access_token.getToken(),i=St+"?access_token="+n;return yield Et.requestPost(i,t)}())}};g.registPlugin("oauth",x),g.registPlugin("cache",F),g.registPlugin("access_token",B),g.registPlugin("jssdk",ie),g.registPlugin("server",qe),g.registPlugin("notice",Ge),g.registPlugin("qrcode",We),g.registPlugin("user",mt),g.registPlugin("menu",xt),g.registPlugin("url",Ut),g.Cache={};for(let e in R)g.Cache[e]=R[e];g.Message={};for(let e in de)g.Message[e]=de[e];module.exports=g;