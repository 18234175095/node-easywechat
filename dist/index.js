/*!
 * EasyWechat.js v1.3.5
 * (c) 2017-2018 Hpyer
 * Released under the MIT License.
 */
"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}function t(e){return new Promise(function(t,n){function i(s,c){try{var o=e[c?"throw":"next"](s)}catch(e){return void n(e)}o.done?t(o.value):Promise.resolve(o.value).then(i,r)}function r(e){i(e,1)}i()})}var n=e(require("merge")),i=e(require("request")),r=e(require("body")),s=e(require("url")),c=e(require("qs")),o=e(require("fs")),a=e(require("path")),u=e(require("wechat-crypto")),l=require("xml2js");class d{constructor(e,t){this.$req=e,this.$res=t}getMethod(){return this.$req?this.$req.method:{}}getQuery(){return this.$req?s.parse(this.$req.url,!0).query:{}}_readBody(){return new Promise((e,t)=>{r(this.$req,(n,i)=>{n?t(n):e(i)})}).catch(e=>{console.log("app_server._readBody()",e)})}getBody(){return t(function*(){return this.$req?yield this._readBody():""}.call(this))}_initResponseOptions(e={}){return e.status=e.status||200,e.contentType=e.contentType||"text/html",e.headers=e.headers||{},e.headers["Content-Type"]=e.contentType,e}sendResponse(e,t={}){if(!this.$res)return!1;t=this._initResponseOptions(t),this.$res.writeHead(t.status,t.headers),this.$res.end(e)}}class f extends d{constructor(e){super(e.req,e.res),this.$ctx=e}sendResponse(e,t={}){if(!this.$ctx)return!1;t=this._initResponseOptions(t),this.$ctx.status=t.status;for(let e in t.headers)this.$ctx.set(e,t.headers[e]);this.$ctx.body=e}}class p extends d{constructor(e,t){super(e,t)}sendResponse(e,t={}){if(!this.$res)return!1;t=this._initResponseOptions(t),this.$res.status(t.status).set(t.headers).send(e)}}const h={appKey:"",appSecret:""};var g=null;class y{constructor(e={}){if(this.$config=n({},h,e),!this.$config.appKey)throw new Error("\u672a\u586b\u5199appKey");if(!this.$config.appSecret)throw new Error("\u672a\u586b\u5199appSecret");g=this,this.$plugins.forEach(e=>{this[e].init(this)})}setAppServerDefault(e,t){this.$config.app=new d(e,t)}setAppServerKoa2(e){this.$config.app=new f(e)}setAppServerExpress(e,t){this.$config.app=new p(e,t)}}y.prototype.requestGet=(e=>new Promise((t,n)=>{i({method:"GET",uri:e},function(e,i,r){if(e)n(e);else{try{r=JSON.parse(r)}catch(e){}t(r)}})})),y.prototype.requestFile=(e=>new Promise((t,n)=>{i({method:"GET",uri:e,encoding:"binary"},function(e,i,r){e?n(e):t(r)})})),y.prototype.requestPost=((e,t=null)=>new Promise((n,r)=>{i({method:"POST",uri:e,json:t},function(e,t,i){e?r(e):n(i)})})),y.prototype.buildApiUrl=(e=>t(function*(){let t=yield g.access_token.getToken();return e+"?access_token="+t}())),y.prototype.$plugins=[],y.registPlugin=((e,t)=>{y.prototype[e]=t,y.prototype.$plugins.push(e)});var m={EasyWechat:y,getInstance:()=>g};const _="https://open.weixin.qq.com/connect/oauth2/authorize",q="https://open.weixin.qq.com/connect/qrconnect",b="https://api.weixin.qq.com/sns/oauth2/access_token",$="https://api.weixin.qq.com/sns/userinfo";class k{constructor(){this.id="",this.nickname="",this.name="",this.avatar="",this.original={},this.token={}}}const w=function(e){},I=function(e=""){let t=m.getInstance();if(!t.$config.oauth)return"";if(!t.$config.oauth.scope)throw new Error("\u672a\u586b\u5199\u6388\u6743scope");if(!t.$config.oauth.redirect)throw new Error("\u672a\u586b\u5199\u6388\u6743\u56de\u8c03\u5730\u5740");let n=t.$config.oauth.redirect;if("http://"!=n.substr(0,7)&&"https://"!=n.substr(0,8))throw new Error("\u8bf7\u586b\u5199\u5b8c\u6574\u7684\u56de\u8c03\u5730\u5740\uff0c\u4ee5\u201chttp://\u201d\u6216\u201chttps://\u201d\u5f00\u5934");let i=_;"snsapi_login"==t.$config.oauth.scope&&(i=q);let r={appid:t.$config.appKey,redirect_uri:n,response_type:"code",scope:t.$config.oauth.scope};return e&&(r.state=e),i+"?"+c.stringify(r)+"#wechat_redirect"},P=function(e){return t(function*(){let t=yield E(e);return"snsapi_base"!=m.getInstance().$config.oauth.scope&&(t=yield T(t)),t}())},E=function(e){return t(function*(){let t=m.getInstance(),n={appid:t.$config.appKey,secret:t.$config.appSecret,code:e,grant_type:"authorization_code"},i=b+"?"+c.stringify(n),r=yield t.requestGet(i),s=new k;return s.id=r.openid,s.token=r,s}())},T=function(e){return t(function*(){let t={access_token:e.token.access_token,openid:e.id,lang:"zh_CN"},n=$+"?"+c.stringify(t),i=yield m.getInstance().requestGet(n);return i.errcode?(console.log("oauth.fetchUserInfo()",i),!1):(e.id=i.openid,e.nickname=i.nickname,e.name=i.nickname,e.avatar=i.headimgurl,e.original=i,e)}())};var U={init:function(e){},redirect:function(e=""){let t=m.getInstance();if(!t.$config.oauth)return"";if(!t.$config.oauth.scope)throw new Error("\u672a\u586b\u5199\u6388\u6743scope");if(!t.$config.oauth.redirect)throw new Error("\u672a\u586b\u5199\u6388\u6743\u56de\u8c03\u5730\u5740");let n=t.$config.oauth.redirect;if("http://"!=n.substr(0,7)&&"https://"!=n.substr(0,8))throw new Error("\u8bf7\u586b\u5199\u5b8c\u6574\u7684\u56de\u8c03\u5730\u5740\uff0c\u4ee5\u201chttp://\u201d\u6216\u201chttps://\u201d\u5f00\u5934");let i=_;"snsapi_login"==t.$config.oauth.scope&&(i=q);let r={appid:t.$config.appKey,redirect_uri:n,response_type:"code",scope:t.$config.oauth.scope};return e&&(r.state=e),i+"?"+c.stringify(r)+"#wechat_redirect"},user:function(e){return t(function*(){let t=yield E(e);return"snsapi_base"!=m.getInstance().$config.oauth.scope&&(t=yield T(t)),t}())}};const A=function(){return parseInt((new Date).getTime()/1e3)},x=function(e=16){let t="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n="";for(let i=0;i<e;i++)n+=t.charAt(Math.floor(Math.random()*t.length));return n},S=function(e){if(!e)return e;if("object"!=typeof e)return e;let t=new Object;for(let n in e)t[n]=S(e[n]);return t},v=function(){let e=arguments;if(0==e.length)return null;let t=S(e[0]);if(1==e.length)return t;for(let n=1;n<e.length;n++)if(e[n]&&"object"==typeof e[n])for(let i in e[n])t[i]=e[n][i];return t},M=function(e){let t=require("crypto").createHash("sha1");return t.update(e),t.digest("hex")};class C{constructor(){this.$options={}}fetch(e){return null}contains(e){return!0}save(e,t=null,n=0){return!0}delete(e){return!0}}class j extends C{constructor(){super(),this.$datas={}}fetch(e){return!this.contains(e)||this.$datas[e].lifeTime>0&&this.$datas[e].lifeTime<A()?null:this.$datas[e].data}contains(e){return"object"==typeof this.$datas[e]}save(e,t=null,n=0){let i={data:t,lifeTime:n>0?n+A():0};return this.$datas[e]=i,!0}delete(e){return delete this.$datas[e],!0}}class N extends C{constructor(e){super();let t={path:"",dirMode:511,fileMode:438,ext:".cache"};this.$options=v(t,e),this.$options.path=a.resolve(this.$options.path);try{o.accessSync(this.$options.path,o.constants.R_OK&o.constants.W_OK)}catch(e){try{o.mkdirSync(this.$options.path,this.$options.dirMode)}catch(e){console.log("\u65e0\u6cd5\u521b\u5efa\u7f13\u5b58\u76ee\u5f55\uff1a"+this.$options.path,e)}}}getCacheFile(e){return this.$options.path+"/"+e+this.$options.ext}fetch(e){let t=null,n=this.getCacheFile(e);try{let e=JSON.parse(o.readFileSync(n,{encoding:"utf-8",flag:"r"}));t=e.lifeTime>0&&e.lifeTime<A()?null:e.data}catch(e){console.log("\u65e0\u6cd5\u8bfb\u53d6\u7f13\u5b58\u6587\u4ef6\uff1a"+n,e),t=null}return t}contains(e){let t=this.getCacheFile(e);try{o.accessSync(t,o.constants.R_OK&o.constants.W_OK)}catch(e){return!1}return!0}save(e,t=null,n=0){let i=this.getCacheFile(e);try{let e={data:t,lifeTime:n>0?n+A():0};o.writeFileSync(i,JSON.stringify(e),{mode:this.$options.fileMode,encoding:"utf-8",flag:"w"})}catch(e){return console.log("\u65e0\u6cd5\u5199\u5165\u7f13\u5b58\u6587\u4ef6\uff1a"+i,e),!1}return!0}delete(e){let t=this.getCacheFile(e);try{o.unlinkSync(t)}catch(e){return console.log("\u65e0\u6cd5\u5220\u9664\u7f13\u5b58\u6587\u4ef6\uff1a"+t,e),!1}return!0}}var R=Object.freeze({CacheInterface:C,MemoryCache:j,FileCache:N});const D=function(e){if(!e.$config.cache)switch(e.$config.cache_driver){case"file":e.$config.cache=new N(e.$config.cache_options);break;case"memory":default:e.$config.cache=new j}},K=function(e){e&&"function"==typeof e.fetch&&"function"==typeof e.contains&&"function"==typeof e.save&&"function"==typeof e.delete&&(m.getInstance().$config.cache=e)};var O={init:function(e){if(!e.$config.cache)switch(e.$config.cache_driver){case"file":e.$config.cache=new N(e.$config.cache_options);break;case"memory":default:e.$config.cache=new j}},setCache:function(e){e&&"function"==typeof e.fetch&&"function"==typeof e.contains&&"function"==typeof e.save&&"function"==typeof e.delete&&(m.getInstance().$config.cache=e)}};const W="https://api.weixin.qq.com/cgi-bin/token",F=function(e){e.$config.access_token_cache_key=e.$config.access_token_cache_key||"NODE_EASYWECHAT_ACCESS_TOKEN"},G=function(){return t(function*(){let e=m.getInstance(),t={appid:e.$config.appKey,secret:e.$config.appSecret,grant_type:"client_credential"},n=W+"?"+c.stringify(t);return yield e.requestGet(n)}())},Q=function(e=!1){return t(function*(){let t=m.getInstance(),n=t.$config.cache.fetch(t.$config.access_token_cache_key);if(e||!n){let e=yield G();H(e.access_token,e.expires_in),n=e.access_token}return n}())},H=function(e,t=7200){let n=m.getInstance();console.log("\u5199\u5165AccessToken: ",n.$config.access_token_cache_key,e,t),n.$config.cache.save(n.$config.access_token_cache_key,e,t)};var J={init:function(e){e.$config.access_token_cache_key=e.$config.access_token_cache_key||"NODE_EASYWECHAT_ACCESS_TOKEN"},getToken:function(e=!1){return t(function*(){let t=m.getInstance(),n=t.$config.cache.fetch(t.$config.access_token_cache_key);if(e||!n){let e=yield G();H(e.access_token,e.expires_in),n=e.access_token}return n}())},setToken:H};const L="https://api.weixin.qq.com/cgi-bin/ticket/getticket",z=function(e){e.$config.jssdk_cache_key=e.$config.jssdk_cache_key||"NODE_EASYWECHAT_JSSKD_TICKET"};var B="";const V=function(e){B=e},Y=function(){return t(function*(){let e=m.getInstance(),t={access_token:yield e.access_token.getToken(),type:"jsapi"},n=L+"?"+c.stringify(t);return yield e.requestGet(n)}())},X=function(e,n=!1,i=!0){return t(function*(){let t=m.getInstance(),r=t.$config.cache.fetch(t.$config.jssdk_cache_key);if(!r){let e=yield Y();console.log("\u5199\u5165JSSDK: ",t.$config.jssdk_cache_key,e.ticket,e.expires_in),t.$config.cache.save(t.$config.jssdk_cache_key,e.ticket,e.expires_in),r=e.ticket}let s=B,c=x(),o=A(),a=Z({jsapi_ticket:r,noncestr:c,timestamp:o,url:s}),u={debug:n,appId:t.$config.appKey,timestamp:o,nonceStr:c,signature:a,url:s,jsApiList:e};return B="",i?JSON.stringify(u):u}())},Z=function(e){let t="",n="";for(let i in e)t+=n+i+"="+e[i],n="&";return M(t)};var ee={init:function(e){e.$config.jssdk_cache_key=e.$config.jssdk_cache_key||"NODE_EASYWECHAT_JSSKD_TICKET"},setUrl:function(e){B=e},config:function(e,n=!1,i=!0){return t(function*(){let t=m.getInstance(),r=t.$config.cache.fetch(t.$config.jssdk_cache_key);if(!r){let e=yield Y();console.log("\u5199\u5165JSSDK: ",t.$config.jssdk_cache_key,e.ticket,e.expires_in),t.$config.cache.save(t.$config.jssdk_cache_key,e.ticket,e.expires_in),r=e.ticket}let s=B,c=x(),o=A(),a=Z({jsapi_ticket:r,noncestr:c,timestamp:o,url:s}),u={debug:n,appId:t.$config.appKey,timestamp:o,nonceStr:c,signature:a,url:s,jsApiList:e};return B="",i?JSON.stringify(u):u}())}};class te{constructor(e){this.dataParams={ToUserName:"",FromUserName:"",CreateTime:A(),MsgType:""},this.json=null,this.data="","object"==typeof e?this.json=e:this.data=e}setAttribute(e,t){this.dataParams[e]=t}formatData(){return"<xml>"+this._formatData(this.dataParams)+"</xml>"}_formatData(e){if("object"==typeof e){let t="";for(let n in e)t+=`<${n}>${this._formatData(e[n])}</${n}>`;return t}return"string"==typeof e?"<![CDATA["+e+"]]>":e}getData(){return this.json?JSON.stringify(this.json):(this.data||(this.data=this.formatData()),this.data)}}class ne extends te{constructor(e){super(""),this.dataParams.MsgType="text",this.dataParams.Content=e.content||""}content(e){this.dataParams.Content=e}}class ie extends te{constructor(e){super(""),this.dataParams.MsgType="image",this.dataParams.Image={MediaId:e.media_id||""}}mediaId(e){this.dataParams.Image.MediaId=e}}class re extends te{constructor(e){super(""),this.dataParams.MsgType="voice",this.dataParams.Voice={MediaId:e.media_id||""}}mediaId(e){this.dataParams.Voice.MediaId=e}}class se extends te{constructor(e){super(""),this.dataParams.MsgType="video",this.dataParams.Video={MediaId:e.media_id||"",Title:e.title||"",Description:e.description||""}}mediaId(e){this.dataParams.Video.MediaId=e}title(e){this.dataParams.Video.Title=e}description(e){this.dataParams.Video.Description=e}}class ce extends te{constructor(e){super(""),this.dataParams.MsgType="music",this.dataParams.Music={MediaId:e.media_id||"",Title:e.title||"",Description:e.description||"",MusicUrl:e.music_url||"",HQMusicUrl:e.hq_music_url||"",ThumbMediaId:e.thumb_media_id||""}}mediaId(e){this.dataParams.Music.MediaId=e}title(e){this.dataParams.Music.Title=e}description(e){this.dataParams.Music.Description=e}musicUrl(e){this.dataParams.Music.MusicUrl=e}hqMusicurl(e){this.dataParams.Music.HQMusicUrl=e}thumbMediaId(e){this.dataParams.Music.ThumbMediaId=e}}class oe extends te{constructor(e){super(""),this.dataParams.MsgType="news",this.dataParams.ArticleCount=1,this.dataParams.Articles={item:{Title:e.title||"",Description:e.description||"",Url:e.url||"",PicUrl:e.image||""}}}title(e){this.dataParams.Articles.item.Title=e}description(e){this.dataParams.Articles.item.Description=e}url(e){this.dataParams.Articles.item.Url=e}picUrl(e){this.dataParams.Articles.item.PicUrl=e}}var ae=Object.freeze({Raw:te,Text:ne,Image:ie,Voice:re,Video:se,Music:ce,News:oe});const ue=function(e){le=function(){}};let le,de;const fe=function(e){"function"!=typeof e&&(e=function(){}),le=e},pe=function(){return t(function*(){let e=m.getInstance(),t=e.$config.app;if(!t)throw new Error("\u672a\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u8bbe\u7f6e\u5e94\u7528\u670d\u52a1\u5668");let n=new u(e.$config.token,e.$config.aesKey,e.$config.appKey);if("GET"==t.getMethod()){let e=t.getQuery();if(!(e.signature&&e.echostr&&e.timestamp&&e.nonce))return void t.sendResponse("Hello node-easywechat");n.getSignature(e.timestamp,e.nonce,e.encrypt)===e.signature?t.sendResponse(e.echostr):t.sendResponse("fail")}else{let e=yield t.getBody();if(de=yield he(e,n),le&&"function"==typeof le){let e=yield le(de);if(!e||"string"==typeof e&&"SUCCESS"==e.toUpperCase())return void t.sendResponse("SUCCESS");let n=null;if((n="string"==typeof e?new ne({content:e}):e)&&"object"==typeof n){n.setAttribute("ToUserName",de.FromUserName),n.setAttribute("FromUserName",de.ToUserName);let e=n.getData();console.log("server.send()",e),t.sendResponse(e)}}}}())},he=function(e,n){return t(function*(){return new Promise((i,r)=>{l.parseString(e,(e,s)=>t(function*(){if(e)r(e);else{let e;if(s&&s.xml){e={};for(let t in s.xml)e[t]=s.xml[t][0];if(e.Encrypt){let t=n.decrypt(e.Encrypt);console.log("decrypted",t),e=yield he(t.message)}}i(e)}}()))}).catch(e=>{console.log("server.parseMessage()",e)})}())},ge=function(){return de};var ye={init:function(e){le=function(){}},setMessageHandler:function(e){"function"!=typeof e&&(e=function(){}),le=e},serve:function(){return t(function*(){let e=m.getInstance(),t=e.$config.app;if(!t)throw new Error("\u672a\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u8bbe\u7f6e\u5e94\u7528\u670d\u52a1\u5668");let n=new u(e.$config.token,e.$config.aesKey,e.$config.appKey);if("GET"==t.getMethod()){let e=t.getQuery();if(!(e.signature&&e.echostr&&e.timestamp&&e.nonce))return void t.sendResponse("Hello node-easywechat");n.getSignature(e.timestamp,e.nonce,e.encrypt)===e.signature?t.sendResponse(e.echostr):t.sendResponse("fail")}else{let e=yield t.getBody();if(de=yield he(e,n),le&&"function"==typeof le){let e=yield le(de);if(!e||"string"==typeof e&&"SUCCESS"==e.toUpperCase())return void t.sendResponse("SUCCESS");let n=null;if((n="string"==typeof e?new ne({content:e}):e)&&"object"==typeof n){n.setAttribute("ToUserName",de.FromUserName),n.setAttribute("FromUserName",de.ToUserName);let e=n.getData();console.log("server.send()",e),t.sendResponse(e)}}}}())},getMessage:function(){return de}};const me="https://api.weixin.qq.com/cgi-bin/message/template/send",_e="https://api.weixin.qq.com/cgi-bin/template/get_industry",qe="https://api.weixin.qq.com/cgi-bin/template/api_set_industry",be="https://api.weixin.qq.com/cgi-bin/template/api_add_template",$e="https://api.weixin.qq.com/cgi-bin/template/get_all_private_template",ke="https://api.weixin.qq.com/cgi-bin/template/del_private_template",we=function(e){Pe=new Ie};class Ie{constructor(){this.reset()}}Ie.prototype.reset=function(){this.touser="",this.template_id="",this.url="",this.miniprogram={},this.data=[]};let Pe=null;const Ee=function(e){return Pe.touser=e,this},Te=function(e){return Pe.template_id=e,this},Ue=function(e){return Pe.url=e,this},Ae=function(e){return Pe.data=xe(e),this},xe=function(e){let t={};for(let n in e){let i=e[n];"object"==typeof i?void 0!==i.length?t[n]={value:i[0],color:i[1]}:t[n]=i:t[n]={value:i}}return t},Se=function(e=null){return t(function*(){if(e?e.data&&(e.data=xe(e.data)):e={},e=n({},Pe,e),Pe.reset(),!e.touser)throw new Error("\u7528\u6237openid\u4e3a\u7a7a");if(!e.template_id)throw new Error("\u6a21\u677fid\u4e3a\u7a7a");let t=m.getInstance(),i=yield t.buildApiUrl(me);return yield t.requestPost(i,e)}())},ve=function(){return t(function*(){let e=m.getInstance(),t=yield e.buildApiUrl(_e);return yield e.requestPost(t)}())},Me=function(e,n){return t(function*(){let t=m.getInstance(),i=yield t.buildApiUrl(qe),r={industry_id1:e,industry_id2:n};return yield t.requestPost(i,r)}())},Ce=function(e){return t(function*(){let t=m.getInstance(),n=yield t.buildApiUrl(be),i={template_id_short:e};return yield t.requestPost(n,i)}())},je=function(){return t(function*(){let e=m.getInstance(),t=yield e.buildApiUrl($e);return yield e.requestPost(t)}())},Ne=function(e){return t(function*(){let t=m.getInstance(),n=yield t.buildApiUrl(ke),i={template_id:e};return yield t.requestPost(n,i)}())};var Re={init:function(e){Pe=new Ie},to:Ee,withTo:Ee,andTo:Ee,receiver:Ee,withReceiver:Ee,andhReceiver:Ee,uses:Te,withUses:Te,andUses:Te,template:Te,withTemplate:Te,andTemplate:Te,templateId:Te,withTemplateId:Te,andTemplateId:Te,url:Ue,withUrl:Ue,andUrl:Ue,link:Ue,withLink:Ue,andLink:Ue,linkTo:Ue,withLinkTo:Ue,andLinkTo:Ue,data:Ae,withData:Ae,andData:Ae,send:function(e=null){return t(function*(){if(e?e.data&&(e.data=xe(e.data)):e={},e=n({},Pe,e),Pe.reset(),!e.touser)throw new Error("\u7528\u6237openid\u4e3a\u7a7a");if(!e.template_id)throw new Error("\u6a21\u677fid\u4e3a\u7a7a");let t=m.getInstance(),i=yield t.buildApiUrl(me);return yield t.requestPost(i,e)}())},getIndustry:function(){return t(function*(){let e=m.getInstance(),t=yield e.buildApiUrl(_e);return yield e.requestPost(t)}())},setIndustry:function(e,n){return t(function*(){let t=m.getInstance(),i=yield t.buildApiUrl(qe),r={industry_id1:e,industry_id2:n};return yield t.requestPost(i,r)}())},addTemplate:function(e){return t(function*(){let t=m.getInstance(),n=yield t.buildApiUrl(be),i={template_id_short:e};return yield t.requestPost(n,i)}())},getPrivateTemplates:function(){return t(function*(){let e=m.getInstance(),t=yield e.buildApiUrl($e);return yield e.requestPost(t)}())},deletePrivateTemplate:function(e){return t(function*(){let t=m.getInstance(),n=yield t.buildApiUrl(ke),i={template_id:e};return yield t.requestPost(n,i)}())}};const De="https://api.weixin.qq.com/cgi-bin/qrcode/create",Ke="https://mp.weixin.qq.com/cgi-bin/showqrcode",Oe=function(e){},We=function(e,n=null){return t(function*(){((n=parseInt(n))<=0||n>604800)&&(n=604800);let t="";"string"==typeof e?(e={scene_str:e},t="QR_STR_SCENE"):(e={scene_id:e},t="QR_SCENE");let i={expire_seconds:n,action_name:t,action_info:{scene:e}},r=m.getInstance(),s=yield r.buildApiUrl(De);return yield r.requestPost(s,i)}())},Fe=function(e){return t(function*(){let t="";"string"==typeof e?(e={scene_str:e},t="QR_LIMIT_STR_SCENE"):(e={scene_id:e},t="QR_LIMIT_SCENE");let n={action_name:t,action_info:{scene:e}},i=m.getInstance(),r=yield i.buildApiUrl(De);return yield i.requestPost(r,n)}())},Ge=function(e){return t(function*(){let t=Ke+"?ticket="+e;return yield m.getInstance().requestFile(t)}())};var Qe={init:function(e){},temporary:function(e,n=null){return t(function*(){((n=parseInt(n))<=0||n>604800)&&(n=604800);let t="";"string"==typeof e?(e={scene_str:e},t="QR_STR_SCENE"):(e={scene_id:e},t="QR_SCENE");let i={expire_seconds:n,action_name:t,action_info:{scene:e}},r=m.getInstance(),s=yield r.buildApiUrl(De);return yield r.requestPost(s,i)}())},forever:function(e){return t(function*(){let t="";"string"==typeof e?(e={scene_str:e},t="QR_LIMIT_STR_SCENE"):(e={scene_id:e},t="QR_LIMIT_SCENE");let n={action_name:t,action_info:{scene:e}},i=m.getInstance(),r=yield i.buildApiUrl(De);return yield i.requestPost(r,n)}())},url:function(e){return t(function*(){let t=Ke+"?ticket="+e;return yield m.getInstance().requestFile(t)}())}};const He="https://api.weixin.qq.com/cgi-bin/user/info",Je="https://api.weixin.qq.com/cgi-bin/user/info/batchget",Le="https://api.weixin.qq.com/cgi-bin/user/get",ze="https://api.weixin.qq.com/cgi-bin/user/info/updateremark",Be="https://api.weixin.qq.com/cgi-bin/tags/members/getblacklist",Ve="https://api.weixin.qq.com/cgi-bin/tags/members/batchblacklist",Ye="https://api.weixin.qq.com/cgi-bin/tags/members/batchunblacklist";class Xe{constructor(){this.id="",this.nickname="",this.name="",this.avatar="",this.original={},this.token={}}}const Ze=function(e){},et=function(e,n="zh_CN"){return t(function*(){let t=m.getInstance(),i=yield t.buildApiUrl(He);i+="&openid="+e+"&lang="+n;let r=yield t.requestGet(i),s=new Xe;return s.id=r.openid,s.nickname=r.nickname,s.name=r.nickname,s.avatar=r.headimgurl,s.original=r,s}())},tt=function(e){return t(function*(){let t=m.getInstance(),n={user_list:e},i=yield t.buildApiUrl(Je);return yield t.requestPost(i,n)}())},nt=function(e=null){return t(function*(){let t=m.getInstance(),n=yield t.buildApiUrl(Le);return e&&(n+="&next_openid="+e),yield t.requestGet(n)}())},it=function(e,n){return t(function*(){let e=m.getInstance(),t=yield e.buildApiUrl(ze);return yield e.requestPost(t)}())},rt=function(e){return t(function*(){let t=m.getInstance(),n={};e&&(n.begin_openid=e);let i=yield t.buildApiUrl(Be);return yield t.requestPost(i,n)}())},st=function(e){return t(function*(){let t=m.getInstance(),n={openid_list:e},i=yield t.buildApiUrl(Ve);return yield t.requestPost(i,n)}())},ct=function(e){return t(function*(){let t=m.getInstance(),n={openid_list:e},i=yield t.buildApiUrl(Ye);return yield t.requestPost(i,n)}())},ot=function(e){return t(function*(){return yield st([e])}())},at=function(e){return t(function*(){return yield ct([e])}())};var ut={init:function(e){},get:function(e,n="zh_CN"){return t(function*(){let t=m.getInstance(),i=yield t.buildApiUrl(He);i+="&openid="+e+"&lang="+n;let r=yield t.requestGet(i),s=new Xe;return s.id=r.openid,s.nickname=r.nickname,s.name=r.nickname,s.avatar=r.headimgurl,s.original=r,s}())},batchGet:function(e){return t(function*(){let t=m.getInstance(),n={user_list:e},i=yield t.buildApiUrl(Je);return yield t.requestPost(i,n)}())},lists:function(e=null){return t(function*(){let t=m.getInstance(),n=yield t.buildApiUrl(Le);return e&&(n+="&next_openid="+e),yield t.requestGet(n)}())},remark:function(e,n){return t(function*(){let e=m.getInstance(),t=yield e.buildApiUrl(ze);return yield e.requestPost(t)}())},blacklist:function(e){return t(function*(){let t=m.getInstance(),n={};e&&(n.begin_openid=e);let i=yield t.buildApiUrl(Be);return yield t.requestPost(i,n)}())},batchBlock:st,batchUnblock:ct,block:function(e){return t(function*(){return yield st([e])}())},unblock:function(e){return t(function*(){return yield ct([e])}())}};const lt="https://api.weixin.qq.com/cgi-bin/menu/get",dt="https://api.weixin.qq.com/cgi-bin/get_current_selfmenu_info",ft="https://api.weixin.qq.com/cgi-bin/menu/create",pt="https://api.weixin.qq.com/cgi-bin/menu/delete",ht=function(e){},gt=function(){return t(function*(){let e=m.getInstance(),t=yield e.buildApiUrl(lt);return yield e.requestPost(t)}())},yt=function(){return t(function*(){let e=m.getInstance(),t=yield e.buildApiUrl(dt);return yield e.requestPost(t)}())},mt=function(e){return t(function*(){let t={button:e},n=m.getInstance(),i=yield n.buildApiUrl(ft);return yield n.requestPost(i,t)}())},_t=function(){return t(function*(){let e=m.getInstance(),t=yield e.buildApiUrl(pt);return yield e.requestPost(t)}())};var qt={init:function(e){},all:function(){return t(function*(){let e=m.getInstance(),t=yield e.buildApiUrl(lt);return yield e.requestPost(t)}())},current:function(){return t(function*(){let e=m.getInstance(),t=yield e.buildApiUrl(dt);return yield e.requestPost(t)}())},add:function(e){return t(function*(){let t={button:e},n=m.getInstance(),i=yield n.buildApiUrl(ft);return yield n.requestPost(i,t)}())},destroy:function(){return t(function*(){let e=m.getInstance(),t=yield e.buildApiUrl(pt);return yield e.requestPost(t)}())}};const bt="https://api.weixin.qq.com/cgi-bin/shorturl",$t=function(e){},kt=function(e){return t(function*(){let t={action:"long2short",long_url:e},n=m.getInstance(),i=yield n.buildApiUrl(bt);return yield n.requestPost(i,t)}())};var wt={init:function(e){},shorten:function(e){return t(function*(){let t={action:"long2short",long_url:e},n=m.getInstance(),i=yield n.buildApiUrl(bt);return yield n.requestPost(i,t)}())}};m.EasyWechat.registPlugin("oauth",U),m.EasyWechat.registPlugin("cache",O),m.EasyWechat.registPlugin("access_token",J),m.EasyWechat.registPlugin("jssdk",ee),m.EasyWechat.registPlugin("server",ye),m.EasyWechat.registPlugin("notice",Re),m.EasyWechat.registPlugin("qrcode",Qe),m.EasyWechat.registPlugin("user",ut),m.EasyWechat.registPlugin("menu",qt),m.EasyWechat.registPlugin("url",wt),m.EasyWechat.Cache={};for(let e in R)m.EasyWechat.Cache[e]=R[e];m.EasyWechat.Message={};for(let e in ae)m.EasyWechat.Message[e]=ae[e];var It=m.EasyWechat;module.exports=It;