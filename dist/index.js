/*!
 * EasyWechat.js v1.3.5
 * (c) 2017-2018 Hpyer
 * Released under the MIT License.
 */
"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}function t(e){return new Promise(function(t,n){function i(s,o){try{var c=e[o?"throw":"next"](s)}catch(e){return void n(e)}c.done?t(c.value):Promise.resolve(c.value).then(i,r)}function r(e){i(e,1)}i()})}function n(e,t){return t={exports:{}},e(t,t.exports),t.exports}var i=e(require("merge")),r=e(require("request")),s=e(require("body")),o=e(require("url")),c=e(require("qs")),a=e(require("fs")),u=e(require("path")),l=e(require("crypto-js/enc")),f=require("xml2js");class d{constructor(e,t){this.$req=e,this.$res=t}getMethod(){return this.$req?this.$req.method:{}}getQuery(){return this.$req?o.parse(this.$req.url,!0).query:{}}_readBody(){return new Promise((e,t)=>{s(this.$req,(n,i)=>{n?t(n):e(i)})}).catch(e=>{console.log("app_server._readBody()",e)})}getBody(){return t(function*(){return this.$req?yield this._readBody():""}.call(this))}_initResponseOptions(e={}){return e.status=e.status||200,e.contentType=e.contentType||"text/html",e.headers=e.headers||{},e.headers["Content-Type"]=e.contentType,e}sendResponse(e,t={}){if(!this.$res)return!1;t=this._initResponseOptions(t),this.$res.writeHead(t.status,t.headers),this.$res.end(e)}}class h extends d{constructor(e){super(e.req,e.res),this.$ctx=e}sendResponse(e,t={}){if(!this.$ctx)return!1;t=this._initResponseOptions(t),this.$ctx.status=t.status;for(let e in t.headers)this.$ctx.set(e,t.headers[e]);this.$ctx.body=e}}class p extends d{constructor(e,t){super(e,t)}sendResponse(e,t={}){if(!this.$res)return!1;t=this._initResponseOptions(t),this.$res.status(t.status).set(t.headers).send(e)}}const g={appKey:"",appSecret:""};var y=null;class _{constructor(e={}){if(this.$config=i({},g,e),!this.$config.appKey)throw new Error("\u672a\u586b\u5199appKey");if(!this.$config.appSecret)throw new Error("\u672a\u586b\u5199appSecret");y=this,this.$plugins.forEach(e=>{this[e].init(this)})}setAppServerDefault(e,t){this.$config.app=new d(e,t)}setAppServerKoa2(e){this.$config.app=new h(e)}setAppServerExpress(e,t){this.$config.app=new p(e,t)}}_.prototype.requestGet=(e=>new Promise((t,n)=>{r({method:"GET",uri:e},function(e,i,r){if(e)n(e);else{try{r=JSON.parse(r)}catch(e){}t(r)}})})),_.prototype.requestFile=(e=>new Promise((t,n)=>{r({method:"GET",uri:e,encoding:"binary"},function(e,i,r){e?n(e):t(r)})})),_.prototype.requestPost=((e,t=null)=>new Promise((n,i)=>{r({method:"POST",uri:e,json:t},function(e,t,r){e?i(e):n(r)})})),_.prototype.buildApiUrl=(e=>t(function*(){let t=yield y.access_token.getToken();return e+"?access_token="+t}())),_.prototype.$plugins=[],_.registPlugin=((e,t)=>{_.prototype[e]=t,_.prototype.$plugins.push(e)});var m={EasyWechat:_,getInstance:()=>y};const v="https://open.weixin.qq.com/connect/oauth2/authorize",k="https://open.weixin.qq.com/connect/qrconnect",w="https://api.weixin.qq.com/sns/oauth2/access_token",b="https://api.weixin.qq.com/sns/userinfo";class x{constructor(){this.id="",this.nickname="",this.name="",this.avatar="",this.original={},this.token={}}}const q=function(e){},S=function(e=""){let t=m.getInstance();if(!t.$config.oauth)return"";if(!t.$config.oauth.scope)throw new Error("\u672a\u586b\u5199\u6388\u6743scope");if(!t.$config.oauth.redirect)throw new Error("\u672a\u586b\u5199\u6388\u6743\u56de\u8c03\u5730\u5740");let n=t.$config.oauth.redirect;if("http://"!=n.substr(0,7)&&"https://"!=n.substr(0,8))throw new Error("\u8bf7\u586b\u5199\u5b8c\u6574\u7684\u56de\u8c03\u5730\u5740\uff0c\u4ee5\u201chttp://\u201d\u6216\u201chttps://\u201d\u5f00\u5934");let i=v;"snsapi_login"==t.$config.oauth.scope&&(i=k);let r={appid:t.$config.appKey,redirect_uri:n,response_type:"code",scope:t.$config.oauth.scope};return e&&(r.state=e),i+"?"+c.stringify(r)+"#wechat_redirect"},$=function(e){return t(function*(){let t=yield I(e);return"snsapi_base"!=m.getInstance().$config.oauth.scope&&(t=yield E(t)),t}())},I=function(e){return t(function*(){let t=m.getInstance(),n={appid:t.$config.appKey,secret:t.$config.appSecret,code:e,grant_type:"authorization_code"},i=w+"?"+c.stringify(n),r=yield t.requestGet(i),s=new x;return s.id=r.openid,s.token=r,s}())},E=function(e){return t(function*(){let t={access_token:e.token.access_token,openid:e.id,lang:"zh_CN"},n=b+"?"+c.stringify(t),i=yield m.getInstance().requestGet(n);return i.errcode?(console.log("oauth.fetchUserInfo()",i),!1):(e.id=i.openid,e.nickname=i.nickname,e.name=i.nickname,e.avatar=i.headimgurl,e.original=i,e)}())};var P={init:function(e){},redirect:function(e=""){let t=m.getInstance();if(!t.$config.oauth)return"";if(!t.$config.oauth.scope)throw new Error("\u672a\u586b\u5199\u6388\u6743scope");if(!t.$config.oauth.redirect)throw new Error("\u672a\u586b\u5199\u6388\u6743\u56de\u8c03\u5730\u5740");let n=t.$config.oauth.redirect;if("http://"!=n.substr(0,7)&&"https://"!=n.substr(0,8))throw new Error("\u8bf7\u586b\u5199\u5b8c\u6574\u7684\u56de\u8c03\u5730\u5740\uff0c\u4ee5\u201chttp://\u201d\u6216\u201chttps://\u201d\u5f00\u5934");let i=v;"snsapi_login"==t.$config.oauth.scope&&(i=k);let r={appid:t.$config.appKey,redirect_uri:n,response_type:"code",scope:t.$config.oauth.scope};return e&&(r.state=e),i+"?"+c.stringify(r)+"#wechat_redirect"},user:function(e){return t(function*(){let t=yield I(e);return"snsapi_base"!=m.getInstance().$config.oauth.scope&&(t=yield E(t)),t}())}};const A=function(){return parseInt((new Date).getTime()/1e3)},T=function(e=16){let t="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n="";for(let i=0;i<e;i++)n+=t.charAt(Math.floor(Math.random()*t.length));return n},M=function(e){if(!e)return e;if("object"!=typeof e)return e;let t=new Object;for(let n in e)t[n]=M(e[n]);return t},C=function(){let e=arguments;if(0==e.length)return null;let t=M(e[0]);if(1==e.length)return t;for(let n=1;n<e.length;n++)if(e[n]&&"object"==typeof e[n])for(let i in e[n])t[i]=e[n][i];return t};var U={getTimestamp:function(){return parseInt((new Date).getTime()/1e3)},randomString:function(e=16){let t="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n="";for(let i=0;i<e;i++)n+=t.charAt(Math.floor(Math.random()*t.length));return n},cloneObj:M,extendObj:function(){let e=arguments;if(0==e.length)return null;let t=M(e[0]);if(1==e.length)return t;for(let n=1;n<e.length;n++)if(e[n]&&"object"==typeof e[n])for(let i in e[n])t[i]=e[n][i];return t}};class B{constructor(){this.$options={}}fetch(e){return null}contains(e){return!0}save(e,t=null,n=0){return!0}delete(e){return!0}}class D extends B{constructor(){super(),this.$datas={}}fetch(e){return!this.contains(e)||this.$datas[e].lifeTime>0&&this.$datas[e].lifeTime<U.getTimestamp()?null:this.$datas[e].data}contains(e){return"object"==typeof this.$datas[e]}save(e,t=null,n=0){let i={data:t,lifeTime:n>0?n+U.getTimestamp():0};return this.$datas[e]=i,!0}delete(e){return delete this.$datas[e],!0}}class R extends B{constructor(e){super();let t={path:"",dirMode:511,fileMode:438,ext:".cache"};this.$options=U.extendObj(t,e),this.$options.path=u.resolve(this.$options.path);try{a.accessSync(this.$options.path,a.constants.R_OK&a.constants.W_OK)}catch(e){try{a.mkdirSync(this.$options.path,this.$options.dirMode)}catch(e){console.log("\u65e0\u6cd5\u521b\u5efa\u7f13\u5b58\u76ee\u5f55\uff1a"+this.$options.path,e)}}}getCacheFile(e){return this.$options.path+"/"+e+this.$options.ext}fetch(e){let t=null,n=this.getCacheFile(e);try{let e=JSON.parse(a.readFileSync(n,{encoding:"utf-8",flag:"r"}));t=e.lifeTime>0&&e.lifeTime<U.getTimestamp()?null:e.data}catch(e){console.log("\u65e0\u6cd5\u8bfb\u53d6\u7f13\u5b58\u6587\u4ef6\uff1a"+n,e),t=null}return t}contains(e){let t=this.getCacheFile(e);try{a.accessSync(t,a.constants.R_OK&a.constants.W_OK)}catch(e){return!1}return!0}save(e,t=null,n=0){let i=this.getCacheFile(e);try{let e={data:t,lifeTime:n>0?n+U.getTimestamp():0};a.writeFileSync(i,JSON.stringify(e),{mode:this.$options.fileMode,encoding:"utf-8",flag:"w"})}catch(e){return console.log("\u65e0\u6cd5\u5199\u5165\u7f13\u5b58\u6587\u4ef6\uff1a"+i,e),!1}return!0}delete(e){let t=this.getCacheFile(e);try{a.unlinkSync(t)}catch(e){return console.log("\u65e0\u6cd5\u5220\u9664\u7f13\u5b58\u6587\u4ef6\uff1a"+t,e),!1}return!0}}var z=Object.freeze({CacheInterface:B,MemoryCache:D,FileCache:R});const j=function(e){if(!e.$config.cache)switch(e.$config.cache_driver){case"file":e.$config.cache=new R(e.$config.cache_options);break;case"memory":default:e.$config.cache=new D}},O=function(e){e&&"function"==typeof e.fetch&&"function"==typeof e.contains&&"function"==typeof e.save&&"function"==typeof e.delete&&(m.getInstance().$config.cache=e)};var N={init:function(e){if(!e.$config.cache)switch(e.$config.cache_driver){case"file":e.$config.cache=new R(e.$config.cache_options);break;case"memory":default:e.$config.cache=new D}},setCache:function(e){e&&"function"==typeof e.fetch&&"function"==typeof e.contains&&"function"==typeof e.save&&"function"==typeof e.delete&&(m.getInstance().$config.cache=e)}};const K="https://api.weixin.qq.com/cgi-bin/token",F=function(e){e.$config.access_token_cache_key=e.$config.access_token_cache_key||"NODE_EASYWECHAT_ACCESS_TOKEN"},H=function(){return t(function*(){let e=m.getInstance(),t={appid:e.$config.appKey,secret:e.$config.appSecret,grant_type:"client_credential"},n=K+"?"+c.stringify(t);return yield e.requestGet(n)}())},W=function(e=!1){return t(function*(){let t=m.getInstance(),n=t.$config.cache.fetch(t.$config.access_token_cache_key);if(e||!n){let e=yield H();G(e.access_token,e.expires_in),n=e.access_token}return n}())},G=function(e,t=7200){let n=m.getInstance();console.log("\u5199\u5165AccessToken: ",n.$config.access_token_cache_key,e,t),n.$config.cache.save(n.$config.access_token_cache_key,e,t)};var Q={init:function(e){e.$config.access_token_cache_key=e.$config.access_token_cache_key||"NODE_EASYWECHAT_ACCESS_TOKEN"},getToken:function(e=!1){return t(function*(){let t=m.getInstance(),n=t.$config.cache.fetch(t.$config.access_token_cache_key);if(e||!n){let e=yield H();G(e.access_token,e.expires_in),n=e.access_token}return n}())},setToken:G},L="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},J=n(function(e,t){!function(n,i){e.exports=t=i()}(0,function(){var e=e||function(e,t){var n=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),i={},r=i.lib={},s=r.Base={extend:function(e){var t=n(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},o=r.WordArray=s.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=void 0!=t?t:4*e.length},toString:function(e){return(e||a).stringify(this)},concat:function(e){var t=this.words,n=e.words,i=this.sigBytes,r=e.sigBytes;if(this.clamp(),i%4)for(o=0;o<r;o++){var s=n[o>>>2]>>>24-o%4*8&255;t[i+o>>>2]|=s<<24-(i+o)%4*8}else for(var o=0;o<r;o+=4)t[i+o>>>2]=n[o>>>2];return this.sigBytes+=r,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=s.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n,i=[],r=0;r<t;r+=4){var s=function(t){var t=t,n=987654321,i=4294967295;return function(){var r=((n=36969*(65535&n)+(n>>16)&i)<<16)+(t=18e3*(65535&t)+(t>>16)&i)&i;return r/=4294967296,(r+=.5)*(e.random()>.5?1:-1)}}(4294967296*(n||e.random()));n=987654071*s(),i.push(4294967296*s()|0)}return new o.init(i,t)}}),c=i.enc={},a=c.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,i=[],r=0;r<n;r++){var s=t[r>>>2]>>>24-r%4*8&255;i.push((s>>>4).toString(16)),i.push((15&s).toString(16))}return i.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i+=2)n[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new o.init(n,t/2)}},u=c.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,i=[],r=0;r<n;r++){var s=t[r>>>2]>>>24-r%4*8&255;i.push(String.fromCharCode(s))}return i.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i++)n[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new o.init(n,t)}},l=c.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},f=r.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,i=n.words,r=n.sigBytes,s=this.blockSize,c=r/(4*s),a=(c=t?e.ceil(c):e.max((0|c)-this._minBufferSize,0))*s,u=e.min(4*a,r);if(a){for(var l=0;l<a;l+=s)this._doProcessBlock(i,l);var f=i.splice(0,a);n.sigBytes-=u}return new o.init(f,u)},clone:function(){var e=s.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),d=(r.Hasher=f.extend({cfg:s.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new d.HMAC.init(e,n).finalize(t)}}}),i.algo={});return i}(Math);return e})}),V=n(function(e,t){!function(n,i){e.exports=t=i(J)}(0,function(e){return function(){var t=e,n=t.lib,i=n.WordArray,r=n.Hasher,s=[],o=t.algo.SHA1=r.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=this._hash.words,i=n[0],r=n[1],o=n[2],c=n[3],a=n[4],u=0;u<80;u++){if(u<16)s[u]=0|e[t+u];else{var l=s[u-3]^s[u-8]^s[u-14]^s[u-16];s[u]=l<<1|l>>>31}var f=(i<<5|i>>>27)+a+s[u];f+=u<20?1518500249+(r&o|~r&c):u<40?1859775393+(r^o^c):u<60?(r&o|r&c|o&c)-1894007588:(r^o^c)-899497514,a=c,c=o,o=r<<30|r>>>2,r=i,i=f}n[0]=n[0]+i|0,n[1]=n[1]+r|0,n[2]=n[2]+o|0,n[3]=n[3]+c|0,n[4]=n[4]+a|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,i=8*e.sigBytes;return t[i>>>5]|=128<<24-i%32,t[14+(i+64>>>9<<4)]=Math.floor(n/4294967296),t[15+(i+64>>>9<<4)]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA1=r._createHelper(o),t.HmacSHA1=r._createHmacHelper(o)}(),e.SHA1})});const X="https://api.weixin.qq.com/cgi-bin/ticket/getticket",Y=function(e){e.$config.jssdk_cache_key=e.$config.jssdk_cache_key||"NODE_EASYWECHAT_JSSKD_TICKET"};var Z="";const ee=function(e){Z=e},te=function(){return t(function*(){let e=m.getInstance(),t={access_token:yield e.access_token.getToken(),type:"jsapi"},n=X+"?"+c.stringify(t);return yield e.requestGet(n)}())},ne=function(e,n=!1,i=!0){return t(function*(){let t=m.getInstance(),r=t.$config.cache.fetch(t.$config.jssdk_cache_key);if(!r){let e=yield te();console.log("\u5199\u5165JSSDK: ",t.$config.jssdk_cache_key,e.ticket,e.expires_in),t.$config.cache.save(t.$config.jssdk_cache_key,e.ticket,e.expires_in),r=e.ticket}let s=Z,o=U.randomString(),c=U.getTimestamp(),a=ie({jsapi_ticket:r,noncestr:o,timestamp:c,url:s}),u={debug:n,appId:t.$config.appKey,timestamp:c,nonceStr:o,signature:a,url:s,jsApiList:e};return Z="",i?JSON.stringify(u):u}())},ie=function(e){let t="",n="";for(let i in e)t+=n+i+"="+e[i],n="&";return V(t)};var re={init:function(e){e.$config.jssdk_cache_key=e.$config.jssdk_cache_key||"NODE_EASYWECHAT_JSSKD_TICKET"},setUrl:function(e){Z=e},config:function(e,n=!1,i=!0){return t(function*(){let t=m.getInstance(),r=t.$config.cache.fetch(t.$config.jssdk_cache_key);if(!r){let e=yield te();console.log("\u5199\u5165JSSDK: ",t.$config.jssdk_cache_key,e.ticket,e.expires_in),t.$config.cache.save(t.$config.jssdk_cache_key,e.ticket,e.expires_in),r=e.ticket}let s=Z,o=U.randomString(),c=U.getTimestamp(),a=ie({jsapi_ticket:r,noncestr:o,timestamp:c,url:s}),u={debug:n,appId:t.$config.appKey,timestamp:c,nonceStr:o,signature:a,url:s,jsApiList:e};return Z="",i?JSON.stringify(u):u}())}};class se{constructor(e){this.dataParams={ToUserName:"",FromUserName:"",CreateTime:U.getTimestamp(),MsgType:""},this.json=null,this.data="","object"==typeof e?this.json=e:this.data=e}setAttribute(e,t){this.dataParams[e]=t}formatData(){return"<xml>"+this._formatData(this.dataParams)+"</xml>"}_formatData(e){if("object"==typeof e){let t="";for(let n in e)t+=`<${n}>${this._formatData(e[n])}</${n}>`;return t}return"string"==typeof e?"<![CDATA["+e+"]]>":e}getData(){return this.json?JSON.stringify(this.json):(this.data||(this.data=this.formatData()),this.data)}}class oe extends se{constructor(e){super(""),this.dataParams.MsgType="text",this.dataParams.Content=e.content||""}content(e){this.dataParams.Content=e}}class ce extends se{constructor(e){super(""),this.dataParams.MsgType="image",this.dataParams.Image={MediaId:e.media_id||""}}mediaId(e){this.dataParams.Image.MediaId=e}}class ae extends se{constructor(e){super(""),this.dataParams.MsgType="voice",this.dataParams.Voice={MediaId:e.media_id||""}}mediaId(e){this.dataParams.Voice.MediaId=e}}class ue extends se{constructor(e){super(""),this.dataParams.MsgType="video",this.dataParams.Video={MediaId:e.media_id||"",Title:e.title||"",Description:e.description||""}}mediaId(e){this.dataParams.Video.MediaId=e}title(e){this.dataParams.Video.Title=e}description(e){this.dataParams.Video.Description=e}}class le extends se{constructor(e){super(""),this.dataParams.MsgType="music",this.dataParams.Music={MediaId:e.media_id||"",Title:e.title||"",Description:e.description||"",MusicUrl:e.music_url||"",HQMusicUrl:e.hq_music_url||"",ThumbMediaId:e.thumb_media_id||""}}mediaId(e){this.dataParams.Music.MediaId=e}title(e){this.dataParams.Music.Title=e}description(e){this.dataParams.Music.Description=e}musicUrl(e){this.dataParams.Music.MusicUrl=e}hqMusicurl(e){this.dataParams.Music.HQMusicUrl=e}thumbMediaId(e){this.dataParams.Music.ThumbMediaId=e}}class fe extends se{constructor(e){super(""),this.dataParams.MsgType="news",this.dataParams.ArticleCount=1,this.dataParams.Articles={item:{Title:e.title||"",Description:e.description||"",Url:e.url||"",PicUrl:e.image||""}}}title(e){this.dataParams.Articles.item.Title=e}description(e){this.dataParams.Articles.item.Description=e}url(e){this.dataParams.Articles.item.Url=e}picUrl(e){this.dataParams.Articles.item.PicUrl=e}}var de=Object.freeze({Raw:se,Text:oe,Image:ce,Voice:ae,Video:ue,Music:le,News:fe}),he=n(function(e,t){!function(n,i){e.exports=t=i(J)}(0,function(e){return function(){function t(e,t,n){for(var r=[],s=0,o=0;o<t;o++)if(o%4){var c=n[e.charCodeAt(o-1)]<<o%4*2,a=n[e.charCodeAt(o)]>>>6-o%4*2;r[s>>>2]|=(c|a)<<24-s%4*8,s++}return i.create(r,s)}var n=e,i=n.lib.WordArray;n.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,i=this._map;e.clamp();for(var r=[],s=0;s<n;s+=3)for(var o=(t[s>>>2]>>>24-s%4*8&255)<<16|(t[s+1>>>2]>>>24-(s+1)%4*8&255)<<8|t[s+2>>>2]>>>24-(s+2)%4*8&255,c=0;c<4&&s+.75*c<n;c++)r.push(i.charAt(o>>>6*(3-c)&63));var a=i.charAt(64);if(a)for(;r.length%4;)r.push(a);return r.join("")},parse:function(e){var n=e.length,i=this._map,r=this._reverseMap;if(!r){r=this._reverseMap=[];for(var s=0;s<i.length;s++)r[i.charCodeAt(s)]=s}var o=i.charAt(64);if(o){var c=e.indexOf(o);-1!==c&&(n=c)}return t(e,n,r)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),e.enc.Base64})}),pe=n(function(e,t){!function(n,i){e.exports=t=i(J)}(0,function(e){return function(t){function n(e,t,n,i,r,s,o){var c=e+(t&n|~t&i)+r+o;return(c<<s|c>>>32-s)+t}function i(e,t,n,i,r,s,o){var c=e+(t&i|n&~i)+r+o;return(c<<s|c>>>32-s)+t}function r(e,t,n,i,r,s,o){var c=e+(t^n^i)+r+o;return(c<<s|c>>>32-s)+t}function s(e,t,n,i,r,s,o){var c=e+(n^(t|~i))+r+o;return(c<<s|c>>>32-s)+t}var o=e,c=o.lib,a=c.WordArray,u=c.Hasher,l=o.algo,f=[];!function(){for(var e=0;e<64;e++)f[e]=4294967296*t.abs(t.sin(e+1))|0}();var d=l.MD5=u.extend({_doReset:function(){this._hash=new a.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var o=0;o<16;o++){var c=t+o,a=e[c];e[c]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}var u=this._hash.words,l=e[t+0],d=e[t+1],h=e[t+2],p=e[t+3],g=e[t+4],y=e[t+5],_=e[t+6],m=e[t+7],v=e[t+8],k=e[t+9],w=e[t+10],b=e[t+11],x=e[t+12],q=e[t+13],S=e[t+14],$=e[t+15],I=u[0],E=u[1],P=u[2],A=u[3];E=s(E=s(E=s(E=s(E=r(E=r(E=r(E=r(E=i(E=i(E=i(E=i(E=n(E=n(E=n(E=n(E,P=n(P,A=n(A,I=n(I,E,P,A,l,7,f[0]),E,P,d,12,f[1]),I,E,h,17,f[2]),A,I,p,22,f[3]),P=n(P,A=n(A,I=n(I,E,P,A,g,7,f[4]),E,P,y,12,f[5]),I,E,_,17,f[6]),A,I,m,22,f[7]),P=n(P,A=n(A,I=n(I,E,P,A,v,7,f[8]),E,P,k,12,f[9]),I,E,w,17,f[10]),A,I,b,22,f[11]),P=n(P,A=n(A,I=n(I,E,P,A,x,7,f[12]),E,P,q,12,f[13]),I,E,S,17,f[14]),A,I,$,22,f[15]),P=i(P,A=i(A,I=i(I,E,P,A,d,5,f[16]),E,P,_,9,f[17]),I,E,b,14,f[18]),A,I,l,20,f[19]),P=i(P,A=i(A,I=i(I,E,P,A,y,5,f[20]),E,P,w,9,f[21]),I,E,$,14,f[22]),A,I,g,20,f[23]),P=i(P,A=i(A,I=i(I,E,P,A,k,5,f[24]),E,P,S,9,f[25]),I,E,p,14,f[26]),A,I,v,20,f[27]),P=i(P,A=i(A,I=i(I,E,P,A,q,5,f[28]),E,P,h,9,f[29]),I,E,m,14,f[30]),A,I,x,20,f[31]),P=r(P,A=r(A,I=r(I,E,P,A,y,4,f[32]),E,P,v,11,f[33]),I,E,b,16,f[34]),A,I,S,23,f[35]),P=r(P,A=r(A,I=r(I,E,P,A,d,4,f[36]),E,P,g,11,f[37]),I,E,m,16,f[38]),A,I,w,23,f[39]),P=r(P,A=r(A,I=r(I,E,P,A,q,4,f[40]),E,P,l,11,f[41]),I,E,p,16,f[42]),A,I,_,23,f[43]),P=r(P,A=r(A,I=r(I,E,P,A,k,4,f[44]),E,P,x,11,f[45]),I,E,$,16,f[46]),A,I,h,23,f[47]),P=s(P,A=s(A,I=s(I,E,P,A,l,6,f[48]),E,P,m,10,f[49]),I,E,S,15,f[50]),A,I,y,21,f[51]),P=s(P,A=s(A,I=s(I,E,P,A,x,6,f[52]),E,P,p,10,f[53]),I,E,w,15,f[54]),A,I,d,21,f[55]),P=s(P,A=s(A,I=s(I,E,P,A,v,6,f[56]),E,P,$,10,f[57]),I,E,_,15,f[58]),A,I,q,21,f[59]),P=s(P,A=s(A,I=s(I,E,P,A,g,6,f[60]),E,P,b,10,f[61]),I,E,h,15,f[62]),A,I,k,21,f[63]),u[0]=u[0]+I|0,u[1]=u[1]+E|0,u[2]=u[2]+P|0,u[3]=u[3]+A|0},_doFinalize:function(){var e=this._data,n=e.words,i=8*this._nDataBytes,r=8*e.sigBytes;n[r>>>5]|=128<<24-r%32;var s=t.floor(i/4294967296),o=i;n[15+(r+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),n[14+(r+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),e.sigBytes=4*(n.length+1),this._process();for(var c=this._hash,a=c.words,u=0;u<4;u++){var l=a[u];a[u]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}return c},clone:function(){var e=u.clone.call(this);return e._hash=this._hash.clone(),e}});o.MD5=u._createHelper(d),o.HmacMD5=u._createHmacHelper(d)}(Math),e.MD5})}),ge=n(function(e,t){!function(n,i){e.exports=t=i(J)}(0,function(e){!function(){var t=e,n=t.lib.Base,i=t.enc.Utf8;t.algo.HMAC=n.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=i.parse(t));var n=e.blockSize,r=4*n;t.sigBytes>r&&(t=e.finalize(t)),t.clamp();for(var s=this._oKey=t.clone(),o=this._iKey=t.clone(),c=s.words,a=o.words,u=0;u<n;u++)c[u]^=1549556828,a[u]^=909522486;s.sigBytes=o.sigBytes=r,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,n=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(n))}})}()})}),ye=n(function(e,t){!function(n,i,r){e.exports=t=i(J)}(0,function(e){return function(){var t=e,n=t.lib,i=n.Base,r=n.WordArray,s=t.algo,o=s.MD5,c=s.EvpKDF=i.extend({cfg:i.extend({keySize:4,hasher:o,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=this.cfg,i=n.hasher.create(),s=r.create(),o=s.words,c=n.keySize,a=n.iterations;o.length<c;){u&&i.update(u);var u=i.update(e).finalize(t);i.reset();for(var l=1;l<a;l++)u=i.finalize(u),i.reset();s.concat(u)}return s.sigBytes=4*c,s}});t.EvpKDF=function(e,t,n){return c.create(n).compute(e,t)}}(),e.EvpKDF})}),_e=n(function(e,t){!function(n,i,r){e.exports=t=i(J)}(0,function(e){e.lib.Cipher||function(t){var n=e,i=n.lib,r=i.Base,s=i.WordArray,o=i.BufferedBlockAlgorithm,c=n.enc.Base64,a=n.algo.EvpKDF,u=i.Cipher=o.extend({cfg:r.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){o.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?m:y}return function(t){return{encrypt:function(n,i,r){return e(i).encrypt(t,n,i,r)},decrypt:function(n,i,r){return e(i).decrypt(t,n,i,r)}}}}()}),l=(i.StreamCipher=u.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),n.mode={}),f=i.BlockCipherMode=r.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),d=l.CBC=function(){function e(e,n,i){var r=this._iv;if(r){s=r;this._iv=t}else var s=this._prevBlock;for(var o=0;o<i;o++)e[n+o]^=s[o]}var n=f.extend();return n.Encryptor=n.extend({processBlock:function(t,n){var i=this._cipher,r=i.blockSize;e.call(this,t,n,r),i.encryptBlock(t,n),this._prevBlock=t.slice(n,n+r)}}),n.Decryptor=n.extend({processBlock:function(t,n){var i=this._cipher,r=i.blockSize,s=t.slice(n,n+r);i.decryptBlock(t,n),e.call(this,t,n,r),this._prevBlock=s}}),n}(),h=(n.pad={}).Pkcs7={pad:function(e,t){for(var n=4*t,i=n-e.sigBytes%n,r=i<<24|i<<16|i<<8|i,o=[],c=0;c<i;c+=4)o.push(r);var a=s.create(o,i);e.concat(a)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},p=(i.BlockCipher=u.extend({cfg:u.cfg.extend({mode:d,padding:h}),reset:function(){u.reset.call(this);var e=this.cfg,t=e.iv,n=e.mode;if(this._xformMode==this._ENC_XFORM_MODE)i=n.createEncryptor;else{var i=n.createDecryptor;this._minBufferSize=1}this._mode&&this._mode.__creator==i?this._mode.init(this,t&&t.words):(this._mode=i.call(n,this,t&&t.words),this._mode.__creator=i)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);t=this._process(!0)}else{var t=this._process(!0);e.unpad(t)}return t},blockSize:4}),i.CipherParams=r.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}})),g=(n.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext,n=e.salt;if(n)i=s.create([1398893684,1701076831]).concat(n).concat(t);else var i=t;return i.toString(c)},parse:function(e){var t=c.parse(e),n=t.words;if(1398893684==n[0]&&1701076831==n[1]){var i=s.create(n.slice(2,4));n.splice(0,4),t.sigBytes-=16}return p.create({ciphertext:t,salt:i})}},y=i.SerializableCipher=r.extend({cfg:r.extend({format:g}),encrypt:function(e,t,n,i){i=this.cfg.extend(i);var r=e.createEncryptor(n,i),s=r.finalize(t),o=r.cfg;return p.create({ciphertext:s,key:n,iv:o.iv,algorithm:e,mode:o.mode,padding:o.padding,blockSize:e.blockSize,formatter:i.format})},decrypt:function(e,t,n,i){return i=this.cfg.extend(i),t=this._parse(t,i.format),e.createDecryptor(n,i).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),_=(n.kdf={}).OpenSSL={execute:function(e,t,n,i){i||(i=s.random(8));var r=a.create({keySize:t+n}).compute(e,i),o=s.create(r.words.slice(t),4*n);return r.sigBytes=4*t,p.create({key:r,iv:o,salt:i})}},m=i.PasswordBasedCipher=y.extend({cfg:y.cfg.extend({kdf:_}),encrypt:function(e,t,n,i){var r=(i=this.cfg.extend(i)).kdf.execute(n,e.keySize,e.ivSize);i.iv=r.iv;var s=y.encrypt.call(this,e,t,r.key,i);return s.mixIn(r),s},decrypt:function(e,t,n,i){i=this.cfg.extend(i),t=this._parse(t,i.format);var r=i.kdf.execute(n,e.keySize,e.ivSize,t.salt);return i.iv=r.iv,y.decrypt.call(this,e,t,r.key,i)}})}()})}),me=n(function(e,t){!function(n,i,r){e.exports=t=i(J)}(0,function(e){return function(){var t=e,n=t.lib.BlockCipher,i=t.algo,r=[],s=[],o=[],c=[],a=[],u=[],l=[],f=[],d=[],h=[];!function(){for(var e=[],t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;for(var n=0,i=0,t=0;t<256;t++){var p=i^i<<1^i<<2^i<<3^i<<4;p=p>>>8^255&p^99,r[n]=p,s[p]=n;var g=e[n],y=e[g],_=e[y],m=257*e[p]^16843008*p;o[n]=m<<24|m>>>8,c[n]=m<<16|m>>>16,a[n]=m<<8|m>>>24,u[n]=m;m=16843009*_^65537*y^257*g^16843008*n;l[p]=m<<24|m>>>8,f[p]=m<<16|m>>>16,d[p]=m<<8|m>>>24,h[p]=m,n?(n=g^e[e[e[_^g]]],i^=e[e[i]]):n=i=1}}();var p=[0,1,2,4,8,16,32,64,128,27,54],g=i.AES=n.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,n=e.sigBytes/4,i=4*((this._nRounds=n+6)+1),s=this._keySchedule=[],o=0;o<i;o++)if(o<n)s[o]=t[o];else{u=s[o-1];o%n?n>6&&o%n==4&&(u=r[u>>>24]<<24|r[u>>>16&255]<<16|r[u>>>8&255]<<8|r[255&u]):(u=r[(u=u<<8|u>>>24)>>>24]<<24|r[u>>>16&255]<<16|r[u>>>8&255]<<8|r[255&u],u^=p[o/n|0]<<24),s[o]=s[o-n]^u}for(var c=this._invKeySchedule=[],a=0;a<i;a++){o=i-a;if(a%4)u=s[o];else var u=s[o-4];c[a]=a<4||o<=4?u:l[r[u>>>24]]^f[r[u>>>16&255]]^d[r[u>>>8&255]]^h[r[255&u]]}}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,o,c,a,u,r)},decryptBlock:function(e,t){n=e[t+1];e[t+1]=e[t+3],e[t+3]=n,this._doCryptBlock(e,t,this._invKeySchedule,l,f,d,h,s);var n=e[t+1];e[t+1]=e[t+3],e[t+3]=n},_doCryptBlock:function(e,t,n,i,r,s,o,c){for(var a=this._nRounds,u=e[t]^n[0],l=e[t+1]^n[1],f=e[t+2]^n[2],d=e[t+3]^n[3],h=4,p=1;p<a;p++){var g=i[u>>>24]^r[l>>>16&255]^s[f>>>8&255]^o[255&d]^n[h++],y=i[l>>>24]^r[f>>>16&255]^s[d>>>8&255]^o[255&u]^n[h++],_=i[f>>>24]^r[d>>>16&255]^s[u>>>8&255]^o[255&l]^n[h++],m=i[d>>>24]^r[u>>>16&255]^s[l>>>8&255]^o[255&f]^n[h++];u=g,l=y,f=_,d=m}var g=(c[u>>>24]<<24|c[l>>>16&255]<<16|c[f>>>8&255]<<8|c[255&d])^n[h++],y=(c[l>>>24]<<24|c[f>>>16&255]<<16|c[d>>>8&255]<<8|c[255&u])^n[h++],_=(c[f>>>24]<<24|c[d>>>16&255]<<16|c[u>>>8&255]<<8|c[255&l])^n[h++],m=(c[d>>>24]<<24|c[u>>>16&255]<<16|c[l>>>8&255]<<8|c[255&f])^n[h++];e[t]=g,e[t+1]=y,e[t+2]=_,e[t+3]=m},keySize:8});t.AES=n._createHelper(g)}(),e.AES})});const ve=function(e){ke=function(){}};let ke,we;const be=function(e){"function"!=typeof e&&(e=function(){}),ke=e},xe=function(){return t(function*(){let e=m.getInstance(),t=e.$config.app;if(!t)throw new Error("\u672a\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u8bbe\u7f6e\u5e94\u7528\u670d\u52a1\u5668");if("GET"==t.getMethod()){let n=t.getQuery();if(!(n.signature&&n.echostr&&n.timestamp&&n.nonce))return void t.sendResponse("Hello node-easywechat");let i=[n.nonce,n.timestamp,e.$config.token].sort();V(i.join(""))===n.signature?t.sendResponse(n.echostr):t.sendResponse("fail")}else{let n=yield t.getBody();if(we=yield qe(n,e.$config.aesKey),ke&&"function"==typeof ke){let e=yield ke(we);if(!e||"string"==typeof e&&"SUCCESS"==e.toUpperCase())return void t.sendResponse("SUCCESS");let n=null;if((n="string"==typeof e?new oe({content:e}):e)&&"object"==typeof n){n.setAttribute("ToUserName",we.FromUserName),n.setAttribute("FromUserName",we.ToUserName);let e=n.getData();console.log("server.send()",e),t.sendResponse(e)}}}}())},qe=function(e,n){return t(function*(){return new Promise((t,i)=>{f.parseString(e,(e,r)=>{if(e)i(e);else{let e;if(r&&r.xml){e={};for(let t in r.xml)e[t]=r.xml[t][0];if(e.Encrypt&&n){let t=me.decrypt(e.Encrypt,n).toString(l.Utf8);console.log("decrypted",t)}}t(e)}})}).catch(e=>{console.log("server.parseMessage()",e)})}())},Se=function(){return we};var $e={init:function(e){ke=function(){}},setMessageHandler:function(e){"function"!=typeof e&&(e=function(){}),ke=e},serve:function(){return t(function*(){let e=m.getInstance(),t=e.$config.app;if(!t)throw new Error("\u672a\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u8bbe\u7f6e\u5e94\u7528\u670d\u52a1\u5668");if("GET"==t.getMethod()){let n=t.getQuery();if(!(n.signature&&n.echostr&&n.timestamp&&n.nonce))return void t.sendResponse("Hello node-easywechat");let i=[n.nonce,n.timestamp,e.$config.token].sort();V(i.join(""))===n.signature?t.sendResponse(n.echostr):t.sendResponse("fail")}else{let n=yield t.getBody();if(we=yield qe(n,e.$config.aesKey),ke&&"function"==typeof ke){let e=yield ke(we);if(!e||"string"==typeof e&&"SUCCESS"==e.toUpperCase())return void t.sendResponse("SUCCESS");let n=null;if((n="string"==typeof e?new oe({content:e}):e)&&"object"==typeof n){n.setAttribute("ToUserName",we.FromUserName),n.setAttribute("FromUserName",we.ToUserName);let e=n.getData();console.log("server.send()",e),t.sendResponse(e)}}}}())},getMessage:function(){return we}};const Ie="https://api.weixin.qq.com/cgi-bin/message/template/send",Ee="https://api.weixin.qq.com/cgi-bin/template/get_industry",Pe="https://api.weixin.qq.com/cgi-bin/template/api_set_industry",Ae="https://api.weixin.qq.com/cgi-bin/template/api_add_template",Te="https://api.weixin.qq.com/cgi-bin/template/get_all_private_template",Me="https://api.weixin.qq.com/cgi-bin/template/del_private_template",Ce=function(e){Be=new Ue};class Ue{constructor(){this.reset()}}Ue.prototype.reset=function(){this.touser="",this.template_id="",this.url="",this.miniprogram={},this.data=[]};let Be=null;const De=function(e){return Be.touser=e,this},Re=function(e){return Be.template_id=e,this},ze=function(e){return Be.url=e,this},je=function(e){return Be.data=Oe(e),this},Oe=function(e){let t={};for(let n in e){let i=e[n];"object"==typeof i?void 0!==i.length?t[n]={value:i[0],color:i[1]}:t[n]=i:t[n]={value:i}}return t},Ne=function(e=null){return t(function*(){if(e?e.data&&(e.data=Oe(e.data)):e={},e=i({},Be,e),Be.reset(),!e.touser)throw new Error("\u7528\u6237openid\u4e3a\u7a7a");if(!e.template_id)throw new Error("\u6a21\u677fid\u4e3a\u7a7a");let t=m.getInstance(),n=yield t.buildApiUrl(Ie);return yield t.requestPost(n,e)}())},Ke=function(){return t(function*(){let e=m.getInstance(),t=yield e.buildApiUrl(Ee);return yield e.requestPost(t)}())},Fe=function(e,n){return t(function*(){let t=m.getInstance(),i=yield t.buildApiUrl(Pe),r={industry_id1:e,industry_id2:n};return yield t.requestPost(i,r)}())},He=function(e){return t(function*(){let t=m.getInstance(),n=yield t.buildApiUrl(Ae),i={template_id_short:e};return yield t.requestPost(n,i)}())},We=function(){return t(function*(){let e=m.getInstance(),t=yield e.buildApiUrl(Te);return yield e.requestPost(t)}())},Ge=function(e){return t(function*(){let t=m.getInstance(),n=yield t.buildApiUrl(Me),i={template_id:e};return yield t.requestPost(n,i)}())};var Qe={init:function(e){Be=new Ue},to:De,withTo:De,andTo:De,receiver:De,withReceiver:De,andhReceiver:De,uses:Re,withUses:Re,andUses:Re,template:Re,withTemplate:Re,andTemplate:Re,templateId:Re,withTemplateId:Re,andTemplateId:Re,url:ze,withUrl:ze,andUrl:ze,link:ze,withLink:ze,andLink:ze,linkTo:ze,withLinkTo:ze,andLinkTo:ze,data:je,withData:je,andData:je,send:function(e=null){return t(function*(){if(e?e.data&&(e.data=Oe(e.data)):e={},e=i({},Be,e),Be.reset(),!e.touser)throw new Error("\u7528\u6237openid\u4e3a\u7a7a");if(!e.template_id)throw new Error("\u6a21\u677fid\u4e3a\u7a7a");let t=m.getInstance(),n=yield t.buildApiUrl(Ie);return yield t.requestPost(n,e)}())},getIndustry:function(){return t(function*(){let e=m.getInstance(),t=yield e.buildApiUrl(Ee);return yield e.requestPost(t)}())},setIndustry:function(e,n){return t(function*(){let t=m.getInstance(),i=yield t.buildApiUrl(Pe),r={industry_id1:e,industry_id2:n};return yield t.requestPost(i,r)}())},addTemplate:function(e){return t(function*(){let t=m.getInstance(),n=yield t.buildApiUrl(Ae),i={template_id_short:e};return yield t.requestPost(n,i)}())},getPrivateTemplates:function(){return t(function*(){let e=m.getInstance(),t=yield e.buildApiUrl(Te);return yield e.requestPost(t)}())},deletePrivateTemplate:function(e){return t(function*(){let t=m.getInstance(),n=yield t.buildApiUrl(Me),i={template_id:e};return yield t.requestPost(n,i)}())}};const Le="https://api.weixin.qq.com/cgi-bin/qrcode/create",Je="https://mp.weixin.qq.com/cgi-bin/showqrcode",Ve=function(e){},Xe=function(e,n=null){return t(function*(){((n=parseInt(n))<=0||n>604800)&&(n=604800);let t="";"string"==typeof e?(e={scene_str:e},t="QR_STR_SCENE"):(e={scene_id:e},t="QR_SCENE");let i={expire_seconds:n,action_name:t,action_info:{scene:e}},r=m.getInstance(),s=yield r.buildApiUrl(Le);return yield r.requestPost(s,i)}())},Ye=function(e){return t(function*(){let t="";"string"==typeof e?(e={scene_str:e},t="QR_LIMIT_STR_SCENE"):(e={scene_id:e},t="QR_LIMIT_SCENE");let n={action_name:t,action_info:{scene:e}},i=m.getInstance(),r=yield i.buildApiUrl(Le);return yield i.requestPost(r,n)}())},Ze=function(e){return t(function*(){let t=Je+"?ticket="+e;return yield m.getInstance().requestFile(t)}())};var et={init:function(e){},temporary:function(e,n=null){return t(function*(){((n=parseInt(n))<=0||n>604800)&&(n=604800);let t="";"string"==typeof e?(e={scene_str:e},t="QR_STR_SCENE"):(e={scene_id:e},t="QR_SCENE");let i={expire_seconds:n,action_name:t,action_info:{scene:e}},r=m.getInstance(),s=yield r.buildApiUrl(Le);return yield r.requestPost(s,i)}())},forever:function(e){return t(function*(){let t="";"string"==typeof e?(e={scene_str:e},t="QR_LIMIT_STR_SCENE"):(e={scene_id:e},t="QR_LIMIT_SCENE");let n={action_name:t,action_info:{scene:e}},i=m.getInstance(),r=yield i.buildApiUrl(Le);return yield i.requestPost(r,n)}())},url:function(e){return t(function*(){let t=Je+"?ticket="+e;return yield m.getInstance().requestFile(t)}())}};const tt="https://api.weixin.qq.com/cgi-bin/user/info",nt="https://api.weixin.qq.com/cgi-bin/user/info/batchget",it="https://api.weixin.qq.com/cgi-bin/user/get",rt="https://api.weixin.qq.com/cgi-bin/user/info/updateremark",st="https://api.weixin.qq.com/cgi-bin/tags/members/getblacklist",ot="https://api.weixin.qq.com/cgi-bin/tags/members/batchblacklist",ct="https://api.weixin.qq.com/cgi-bin/tags/members/batchunblacklist";class at{constructor(){this.id="",this.nickname="",this.name="",this.avatar="",this.original={},this.token={}}}const ut=function(e){},lt=function(e,n="zh_CN"){return t(function*(){let t=m.getInstance(),i=yield t.buildApiUrl(tt);i+="&openid="+e+"&lang="+n;let r=yield t.requestGet(i),s=new at;return s.id=r.openid,s.nickname=r.nickname,s.name=r.nickname,s.avatar=r.headimgurl,s.original=r,s}())},ft=function(e){return t(function*(){let t=m.getInstance(),n={user_list:e},i=yield t.buildApiUrl(nt);return yield t.requestPost(i,n)}())},dt=function(e=null){return t(function*(){let t=m.getInstance(),n=yield t.buildApiUrl(it);return e&&(n+="&next_openid="+e),yield t.requestGet(n)}())},ht=function(e,n){return t(function*(){let e=m.getInstance(),t=yield e.buildApiUrl(rt);return yield e.requestPost(t)}())},pt=function(e){return t(function*(){let t=m.getInstance(),n={};e&&(n.begin_openid=e);let i=yield t.buildApiUrl(st);return yield t.requestPost(i,n)}())},gt=function(e){return t(function*(){let t=m.getInstance(),n={openid_list:e},i=yield t.buildApiUrl(ot);return yield t.requestPost(i,n)}())},yt=function(e){return t(function*(){let t=m.getInstance(),n={openid_list:e},i=yield t.buildApiUrl(ct);return yield t.requestPost(i,n)}())},_t=function(e){return t(function*(){return yield gt([e])}())},mt=function(e){return t(function*(){return yield yt([e])}())};var vt={init:function(e){},get:function(e,n="zh_CN"){return t(function*(){let t=m.getInstance(),i=yield t.buildApiUrl(tt);i+="&openid="+e+"&lang="+n;let r=yield t.requestGet(i),s=new at;return s.id=r.openid,s.nickname=r.nickname,s.name=r.nickname,s.avatar=r.headimgurl,s.original=r,s}())},batchGet:function(e){return t(function*(){let t=m.getInstance(),n={user_list:e},i=yield t.buildApiUrl(nt);return yield t.requestPost(i,n)}())},lists:function(e=null){return t(function*(){let t=m.getInstance(),n=yield t.buildApiUrl(it);return e&&(n+="&next_openid="+e),yield t.requestGet(n)}())},remark:function(e,n){return t(function*(){let e=m.getInstance(),t=yield e.buildApiUrl(rt);return yield e.requestPost(t)}())},blacklist:function(e){return t(function*(){let t=m.getInstance(),n={};e&&(n.begin_openid=e);let i=yield t.buildApiUrl(st);return yield t.requestPost(i,n)}())},batchBlock:gt,batchUnblock:yt,block:function(e){return t(function*(){return yield gt([e])}())},unblock:function(e){return t(function*(){return yield yt([e])}())}};const kt="https://api.weixin.qq.com/cgi-bin/menu/get",wt="https://api.weixin.qq.com/cgi-bin/get_current_selfmenu_info",bt="https://api.weixin.qq.com/cgi-bin/menu/create",xt="https://api.weixin.qq.com/cgi-bin/menu/delete",qt=function(e){},St=function(){return t(function*(){let e=m.getInstance(),t=yield e.buildApiUrl(kt);return yield e.requestPost(t)}())},$t=function(){return t(function*(){let e=m.getInstance(),t=yield e.buildApiUrl(wt);return yield e.requestPost(t)}())},It=function(e){return t(function*(){let t={button:e},n=m.getInstance(),i=yield n.buildApiUrl(bt);return yield n.requestPost(i,t)}())},Et=function(){return t(function*(){let e=m.getInstance(),t=yield e.buildApiUrl(xt);return yield e.requestPost(t)}())};var Pt={init:function(e){},all:function(){return t(function*(){let e=m.getInstance(),t=yield e.buildApiUrl(kt);return yield e.requestPost(t)}())},current:function(){return t(function*(){let e=m.getInstance(),t=yield e.buildApiUrl(wt);return yield e.requestPost(t)}())},add:function(e){return t(function*(){let t={button:e},n=m.getInstance(),i=yield n.buildApiUrl(bt);return yield n.requestPost(i,t)}())},destroy:function(){return t(function*(){let e=m.getInstance(),t=yield e.buildApiUrl(xt);return yield e.requestPost(t)}())}};const At="https://api.weixin.qq.com/cgi-bin/shorturl",Tt=function(e){},Mt=function(e){return t(function*(){let t={action:"long2short",long_url:e},n=m.getInstance(),i=yield n.buildApiUrl(At);return yield n.requestPost(i,t)}())};var Ct={init:function(e){},shorten:function(e){return t(function*(){let t={action:"long2short",long_url:e},n=m.getInstance(),i=yield n.buildApiUrl(At);return yield n.requestPost(i,t)}())}};m.EasyWechat.registPlugin("oauth",P),m.EasyWechat.registPlugin("cache",N),m.EasyWechat.registPlugin("access_token",Q),m.EasyWechat.registPlugin("jssdk",re),m.EasyWechat.registPlugin("server",$e),m.EasyWechat.registPlugin("notice",Qe),m.EasyWechat.registPlugin("qrcode",et),m.EasyWechat.registPlugin("user",vt),m.EasyWechat.registPlugin("menu",Pt),m.EasyWechat.registPlugin("url",Ct),m.EasyWechat.Cache={};for(let e in z)m.EasyWechat.Cache[e]=z[e];m.EasyWechat.Message={};for(let e in de)m.EasyWechat.Message[e]=de[e];var Ut=m.EasyWechat;module.exports=Ut;